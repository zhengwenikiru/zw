{"ast":null,"code":"import _toConsumableArray from\"/Users/zhengwen/Desktop/zw/vote-app/vote-front/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/zhengwen/Desktop/zw/vote-app/vote-front/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/zhengwen/Desktop/zw/vote-app/vote-front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/zhengwen/Desktop/zw/vote-app/vote-front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/zhengwen/Desktop/zw/vote-app/vote-front/node_modules/@babel/runtime/regenerator/index.js\";//创建投票界面\nimport axios from\"axios\";import{useNavigate}from\"react-router-dom\";import{produce}from\"immer\";import{useInput,useQuery,useBooleanInput,forceLogin}from\"./hooks\";import{useMemo,useState}from\"react\";import dayjs from\"dayjs\";import'./create-vote.css';import{Divider,Button,Input}from'antd';import'antd/dist/antd.css';//use-immer是对useState的简单包装。不必再调produce，可以对任意数据类型进行修改\n//传给setOption的函数就是用于修改的函数§\n// import { set } from \"immer/dist/internal\"\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CreateVote(_ref){var userInfo=_ref.userInfo;var _useState=useState(['','']),_useState2=_slicedToArray(_useState,2),options=_useState2[0],setOptions=_useState2[1];var title=useInput();var desc=useInput();var deadline=useInput(useMemo(function(){return dayjs().add(1,'week').format('YYYY-MM-DDTHH:mm');},[]));var anonymous=useBooleanInput();var navigate=useNavigate();var query=useQuery();function remove(idx){setOptions(produce(options,function(options){options.splice(idx,1);}));}function setOption(idx,val){setOptions(produce(options,function(options){options[idx]=val;}));// console.log(options)\n}function create(){return _create.apply(this,arguments);}function _create(){_create=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var vote,res,createdVote;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:vote={title:title.value,desc:desc.value,options:options,deadline:deadline.value,anonymous:anonymous.checked,multiple:query.get('multiple')==='1'?true:false};// console.log(vote)\n_context.prev=1;_context.next=4;return axios.post('/vote',vote);case 4:res=_context.sent;createdVote=res.data.result;//data里有创建好的投票信息\nnavigate(\"/view-vote/\"+createdVote.voteId);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);throw _context.t0;case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return _create.apply(this,arguments);}return/*#__PURE__*/ (// <div id=\"fa\">\n//   <h1 style={{margin:'0 auto'}}>创建投票</h1>\n//   <div className=\"inputs\"><input type=\"text\" placeholder=\"投票标题\" {...title}/></div>\n//   <div className=\"inputs\"><input type=\"text\" placeholder=\"补充描述(选填)\" {...desc}/></div>\n//   {\n//     options.map((option, idx) =>\n//       <div key={idx} className=\"inputs\">\n//         <div>\n//         <input className=\"option\" type=\"text\" placeholder=\"选项\" value={option} onChange={e => setOption(idx, e.target.value)}/>\n//         <button tabIndex=\"-1\" onClick={() => remove(idx)}>×</button>\n//         </div>\n//       </div>\n//     )\n//   }\n//     <div className='bottom'>\n//     <div> <button onClick={() => setOptions(options => [...options,''])}>添加选项</button></div>\n//     <div className=\"any\" title=\"此项选中后一经投票无法修改\">匿名投票:<input type=\"checkbox\"  {...anonymous} /></div>\n//     <div className=\"time\"><span>截止日期:</span><input type=\"datetime-local\" {...deadline} /> </div>      \n//     </div>\n//   <div className=\"ensure\"><button onClick={create}>创建投票</button></div>\n// </div>\n_jsxs(\"div\",{id:\"crvo\",children:[/*#__PURE__*/_jsx(Divider,{orientation:\"left\",children:\"\\u521B\\u5EFA\\u6295\\u7968\"}),/*#__PURE__*/_jsx(\"div\",{className:\"tt\",children:/*#__PURE__*/_jsx(Input,_objectSpread({type:\"text\",placeholder:\"\\u6295\\u7968\\u6807\\u9898\"},title))}),/*#__PURE__*/_jsx(\"div\",{className:\"tt\",children:/*#__PURE__*/_jsx(Input,_objectSpread({type:\"text\",placeholder:\"\\u8865\\u5145\\u63CF\\u8FF0(\\u9009\\u586B)\"},desc))}),/*#__PURE__*/_jsx(\"ul\",{children:options.map(function(option,idx){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Input,{spellCheck:\"false\",type:\"text\",placeholder:\"\\u9009\\u9879\",value:option,onChange:function onChange(e){return setOption(idx,e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{tabIndex:\"-1\",onClick:function onClick(){return remove(idx);},children:\"\\u5220\\u9664\"})]})},idx);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bottom\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"any\",title:\"\\u6B64\\u9879\\u9009\\u4E2D\\u540E\\u4E00\\u7ECF\\u6295\\u7968\\u65E0\\u6CD5\\u4FEE\\u6539\",children:[\" \\u533F\\u540D\\u6295\\u7968: \",/*#__PURE__*/_jsx(\"input\",_objectSpread({type:\"checkbox\"},anonymous))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"add\",children:[\" \",/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setOptions(function(options){return[].concat(_toConsumableArray(options),['']);});},children:\"\\u6DFB\\u52A0\\u9009\\u9879\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"time\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u622A\\u6B62\\u65E5\\u671F:\"}),/*#__PURE__*/_jsx(\"input\",_objectSpread({type:\"datetime-local\"},deadline)),\" \"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sub\",children:/*#__PURE__*/_jsx(Button,{size:\"large\",onClick:create,children:\"\\u521B\\u5EFA\\u6295\\u7968\"})})]}));}export default forceLogin(CreateVote);","map":{"version":3,"sources":["/Users/zhengwen/Desktop/zw/vote-app/vote-front/src/Create-vote.js"],"names":["axios","useNavigate","produce","useInput","useQuery","useBooleanInput","forceLogin","useMemo","useState","dayjs","Divider","Button","Input","CreateVote","userInfo","options","setOptions","title","desc","deadline","add","format","anonymous","navigate","query","remove","idx","splice","setOption","val","create","vote","value","checked","multiple","get","post","res","createdVote","data","result","voteId","map","option","e","target"],"mappings":"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","sourcesContent":["//创建投票界面\nimport axios from \"axios\"\nimport { useNavigate } from \"react-router-dom\"\nimport { produce } from \"immer\"\nimport { useInput ,useQuery,useBooleanInput, forceLogin} from \"./hooks\"\nimport { useMemo, useState } from \"react\"\nimport dayjs from \"dayjs\"\nimport './create-vote.css'\nimport { Divider,Button,Input} from 'antd'\nimport 'antd/dist/antd.css';\n\n//use-immer是对useState的简单包装。不必再调produce，可以对任意数据类型进行修改\n//传给setOption的函数就是用于修改的函数§\n// import { set } from \"immer/dist/internal\"\n function CreateVote({ userInfo }){\n  var [options,setOptions] = useState(['',''])\n  var title = useInput()\n  var desc = useInput()\n  var deadline  =  useInput(useMemo(()=>dayjs().add(1,'week').format('YYYY-MM-DDTHH:mm'),[]))\n  var anonymous = useBooleanInput()\n  var navigate = useNavigate()\n  var query = useQuery()\n  function remove(idx){\n    setOptions(\n      produce( options,options =>{\n        options.splice(idx,1)\n      }\n    ))\n  }\n\n  function setOption(idx,val){\n    setOptions(\n      produce(options,options =>{\n        options[idx] = val\n      }\n    ))\n    // console.log(options)\n  }\n\n async function create(){\n    var vote = {\n      title:title.value,\n      desc:desc.value,\n      options:options,\n      deadline:deadline.value,\n      anonymous:anonymous.checked,\n      multiple:query.get('multiple') === '1' ? true : false\n    }\n    // console.log(vote)\n    try{\n      var res =  await axios.post('/vote',vote)\n      var createdVote = res.data.result//data里有创建好的投票信息\n      navigate(\"/view-vote/\"+createdVote.voteId)\n    }catch(e){\n      throw e\n    }\n  }\n\n\n  return(\n    // <div id=\"fa\">\n    //   <h1 style={{margin:'0 auto'}}>创建投票</h1>\n    //   <div className=\"inputs\"><input type=\"text\" placeholder=\"投票标题\" {...title}/></div>\n    //   <div className=\"inputs\"><input type=\"text\" placeholder=\"补充描述(选填)\" {...desc}/></div>\n\n    //   {\n    //     options.map((option, idx) =>\n    //       <div key={idx} className=\"inputs\">\n    //         <div>\n    //         <input className=\"option\" type=\"text\" placeholder=\"选项\" value={option} onChange={e => setOption(idx, e.target.value)}/>\n    //         <button tabIndex=\"-1\" onClick={() => remove(idx)}>×</button>\n    //         </div>\n    //       </div>\n    //     )\n    //   }\n   \n    //     <div className='bottom'>\n    //     <div> <button onClick={() => setOptions(options => [...options,''])}>添加选项</button></div>\n    //     <div className=\"any\" title=\"此项选中后一经投票无法修改\">匿名投票:<input type=\"checkbox\"  {...anonymous} /></div>\n    //     <div className=\"time\"><span>截止日期:</span><input type=\"datetime-local\" {...deadline} /> </div>      \n    //     </div>\n  \n    //   <div className=\"ensure\"><button onClick={create}>创建投票</button></div>\n    // </div>\n\n    <div id=\"crvo\">\n        <Divider orientation=\"left\">创建投票</Divider>\n   \n      <div className=\"tt\"><Input type=\"text\" placeholder=\"投票标题\" {...title}/></div>\n      <div className=\"tt\"><Input type=\"text\" placeholder=\"补充描述(选填)\" {...desc}/></div>\n    <ul>\n      {\n        options.map((option, idx) =>\n          <li key={idx} >\n            <div>\n            <Input  spellCheck=\"false\" type=\"text\" placeholder=\"选项\" value={option} onChange={e => setOption(idx, e.target.value)}/>\n            <button tabIndex=\"-1\" onClick={() => remove(idx)}>删除</button>\n            </div>\n          </li>\n        )\n      }   \n    </ul>\n\n       <div className='bottom'>\n        <div className=\"any\" title=\"此项选中后一经投票无法修改\"> 匿名投票: <input  type=\"checkbox\"  {...anonymous} /></div>\n        <div className=\"add\"> <button onClick={() => setOptions(options => [...options,''])}>添加选项</button></div>\n        <div className=\"time\"><span>截止日期:</span><input type=\"datetime-local\" {...deadline} /> </div>      \n       </div>\n  \n      <div className=\"sub\"><Button size='large'  onClick={create}>创建投票</Button></div>\n    \n    </div>\n  )\n}\n\nexport default forceLogin(CreateVote)"]},"metadata":{},"sourceType":"module"}