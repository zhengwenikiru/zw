{"ast":null,"code":"import _objectSpread from\"/Users/zhengwen/Desktop/zw/vote-app/vote-front/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/zhengwen/Desktop/zw/vote-app/vote-front/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useState,useMemo,useEffect,useContext}from\"react\";import{useLocation}from\"react-router-dom\";import{UserContext}from'./CurrentUserInfo';import axios from\"axios\";import RequireLogin from'./RequireLogin';import{jsx as _jsx}from\"react/jsx-runtime\";export function useInput(){var init=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var _useState=useState(init),_useState2=_slicedToArray(_useState,2),value=_useState2[0],setValue=_useState2[1];var onChange=useCallback(function onChange(e){setValue(e.target.value);},[]);return{value:value,onChange:onChange};}export function useBooleanInput(){var init=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var _useState3=useState(init),_useState4=_slicedToArray(_useState3,2),checked=_useState4[0],setChecked=_useState4[1];var onChange=useCallback(function onChange(e){setChecked(e.target.checked);},[]);return{checked:checked,onChange:onChange};}export function useQuery(){var search=useLocation().search;return useMemo(function(){return new URLSearchParams(search);},[search]);}//从url中获取?后面的部分\nexport function useAxios(config){var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),data=_useState6[0],setData=_useState6[1];// 用来存放请求结果的\nvar _useState7=useState(),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];// 用来存放错误结果的\nvar _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];// 用来存放是否还在加载中\nvar _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),i=_useState12[0],setI=_useState12[1];useEffect(function(){var CancelToken=axios.CancelToken;var source=CancelToken.source();var req=axios(_objectSpread(_objectSpread({},config),{},{cancelToken:source.token}));req.then(function(res){if(res.data.code==0){setData(res.data.result);setError(null);}else{setError(res.data.msg);}setLoading(false);}).catch(function(e){setError(e.toString());setLoading(false);});return function(){return source.cancel();};},[config.url,i]);var update=useCallback(function update(){setLoading(true);setI(function(i){return i+1;});},[]);return{data:data,loading:loading,error:error,update:update};}//拿到当前登陆用户的业务Hook\nexport function useUser(){return useContext(UserContext);//拿到CurentUserInfo文件中 UserContext.Provider传的 userInfo的信息\n}//强制登陆的高阶组件，用它包裹的组件必须登陆才能显示\nexport function forceLogin(Comp){var _Comp$displayName;function ForceLoginComp(props){var userInfo=useUser();if(userInfo.loading){return null;}if(userInfo.error){return/*#__PURE__*/_jsx(RequireLogin,{});}return/*#__PURE__*/_jsx(Comp,_objectSpread(_objectSpread({},props),{},{userInfo:userInfo}));//把forceLogin组件的props传给comp组件\n}ForceLoginComp.displayName='ForceLogin'+((_Comp$displayName=Comp.displayName)!==null&&_Comp$displayName!==void 0?_Comp$displayName:Comp.name);return ForceLoginComp;}","map":{"version":3,"sources":["/Users/zhengwen/Desktop/zw/vote-app/vote-front/src/hooks.js"],"names":["useCallback","useState","useMemo","useEffect","useContext","useLocation","UserContext","axios","RequireLogin","useInput","init","value","setValue","onChange","e","target","useBooleanInput","checked","setChecked","useQuery","search","URLSearchParams","useAxios","config","data","setData","error","setError","loading","setLoading","i","setI","CancelToken","source","req","cancelToken","token","then","res","code","result","msg","catch","toString","cancel","url","update","useUser","forceLogin","Comp","ForceLoginComp","props","userInfo","displayName","name"],"mappings":"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","sourcesContent":["import { useCallback,useState ,useMemo,useEffect, useContext} from \"react\"\nimport { useLocation } from \"react-router-dom\"\nimport{ UserContext } from './CurrentUserInfo'\nimport axios from \"axios\"\nimport RequireLogin from './RequireLogin'\n\n\nexport function useInput(init=''){\n  var [value,setValue] = useState(init)\n  var onChange = useCallback(function onChange(e){\n      setValue(e.target.value)\n  },[])\n  return{\n    value,onChange\n  }\n}\n\nexport function useBooleanInput(init = false){\n  var [checked,setChecked] = useState(init)\n  var onChange = useCallback(function onChange(e){\n    setChecked(e.target.checked)\n  },[])\n  return {\n    checked,onChange\n  }\n}\n\nexport function useQuery(){\n  var search = useLocation().search\n  return useMemo(()=>new URLSearchParams(search),[search])\n}\n//从url中获取?后面的部分\n\n\nexport function useAxios(config) {\n  var [data, setData] = useState() // 用来存放请求结果的\n  var [error, setError] = useState() // 用来存放错误结果的\n  var [loading, setLoading] = useState(true) // 用来存放是否还在加载中\n  var [i, setI] = useState(0)\n\n  useEffect(() => {\n    const CancelToken = axios.CancelToken;\n    const source = CancelToken.source();\n\n    var req = axios({\n      ...config,\n      cancelToken: source.token\n    })\n\n    req.then(res => {\n      if (res.data.code == 0) {\n        setData(res.data.result)\n        setError(null)\n      } else {\n        setError(res.data.msg)\n      }\n      setLoading(false)\n    }).catch(e => {\n      setError(e.toString())\n      setLoading(false)\n    })\n\n    return () => source.cancel()\n  }, [config.url, i])\n\n  var update = useCallback(function update() {\n    setLoading(true)\n    setI(i => i + 1)\n  }, [])\n  return {\n    data,\n    loading,\n    error,\n    update,\n  }\n}\n\n//拿到当前登陆用户的业务Hook\nexport function useUser(){\n  return useContext(UserContext)\n  //拿到CurentUserInfo文件中 UserContext.Provider传的 userInfo的信息\n}\n\n\n//强制登陆的高阶组件，用它包裹的组件必须登陆才能显示\n  export function forceLogin(Comp){\n    function ForceLoginComp(props){\n      var userInfo = useUser()\n      if(userInfo.loading){\n        return  null\n      }\n      if(userInfo.error){\n        return <RequireLogin />\n      }\n      return <Comp {...props} userInfo = {userInfo}  />\n      //把forceLogin组件的props传给comp组件\n    }\n\n    ForceLoginComp.displayName = 'ForceLogin' +(Comp.displayName ?? Comp.name)\n\n    return ForceLoginComp\n  }"]},"metadata":{},"sourceType":"module"}