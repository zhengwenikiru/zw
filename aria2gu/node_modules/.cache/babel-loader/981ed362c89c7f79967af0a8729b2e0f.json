{"remainingRequest":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/thread-loader/dist/cjs.js!/Users/zhengwen/Desktop/zw/aria2gu/node_modules/babel-loader/lib/index.js!/Users/zhengwen/Desktop/zw/aria2gu/node_modules/eslint-loader/index.js??ref--14-0!/Users/zhengwen/Desktop/zw/aria2gu/src/aria2-client.js","dependencies":[{"path":"/Users/zhengwen/Desktop/zw/aria2gu/src/aria2-client.js","mtime":1638688400789},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/babel.config.js","mtime":1637998144475},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/thread-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/babel-loader/lib/index.js","mtime":1637998138838},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/eslint-loader/index.js","mtime":1637998138707}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvemhlbmd3ZW4vRGVza3RvcC96dy9hcmlhMmd1L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjay5qcyI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL1VzZXJzL3poZW5nd2VuL0Rlc2t0b3AvencvYXJpYTJndS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi5zdHJpbmdpZnkuanMiOwoKdmFyIEFyaWEyQ2xpZW50ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBBcmlhMkNsaWVudChvcHRpb25zKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBcmlhMkNsaWVudCk7CgogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIHRoaXMud2Vic29ja2V0ID0gbmV3IFdlYlNvY2tldCgid3M6Ly8iLmNvbmNhdChvcHRpb25zLmhvc3QsICI6IikuY29uY2F0KG9wdGlvbnMucG9ydCwgIi9qc29ucnBjIikpOyAvLyDlj6rmnIl3ZWJzb2NrZXTov57mjqXkuIrkuobmiY3kvJpyZXNvbHZlCgogICAgdGhpcy5jb25uZWN0UHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgX3RoaXMud2Vic29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ29wZW4nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKCiAgICAgIF90aGlzLndlYnNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmVqZWN0KCdXU19DT05ORUNUX0VSUk9SJyk7CiAgICAgIH0pOwogICAgfSk7IC8vIOWPquiAg+iZkei/nuaOpeaIkOWKn+eahOaDheWGtQoKICAgIHRoaXMubGFzdElkID0gMTsgLy8g5qCH6K6w5q+P5Liq6K+35rGC55qESUQgIOWmguaenOmHh+eUqEh0dHDvvIzljZXlkJHkvKDovpPvvIzmr4/mrKHliJvlu7rnmoTpg73mmK/mlrDov57mjqXlsLHkuI3nlKjmoIforrAKCiAgICB0aGlzLmNhbGxiYWNrcyA9IHt9OyAvLyDlrZjmlL7mr4/kuKror7fmsYLnmoTlm57osIMKICAgIC8vIOagueaNruaOpeaUtuWIsOeahOa2iOaBr+eahGlk5bGe5oCn77yM6LCD55So55u45bqU55qE5Zue6LCD5Ye95pWwCgogICAgdGhpcy53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShlLmRhdGEpOwogICAgICB2YXIgY2FsbGJhY2sgPSBfdGhpcy5jYWxsYmFja3NbZGF0YS5pZF07CiAgICAgIGRlbGV0ZSBfdGhpcy5jYWxsYmFja3NbZGF0YS5pZF07CgogICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09ICdmdW5jdGlvbicpIHsKICAgICAgICBjYWxsYmFjayhkYXRhKTsKICAgICAgfQogICAgfSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoQXJpYTJDbGllbnQsIFt7CiAgICBrZXk6ICJyZWFkeSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVhZHkoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbm5lY3RQcm9taXNlOwogICAgfQogIH0sIHsKICAgIGtleTogImNsb3NlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLndlYnNvY2tldC5jbG9zZSgpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIF90aGlzMi53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEFyaWEyQ2xpZW50Owp9KCk7CgpbImFkZFVyaSIsICJhZGRUb3JyZW50IiwgImdldFBlZXJzIiwgImFkZE1ldGFsaW5rIiwgInJlbW92ZSIsICJwYXVzZSIsICJmb3JjZVBhdXNlIiwgInBhdXNlQWxsIiwgImZvcmNlUGF1c2VBbGwiLCAidW5wYXVzZSIsICJ1bnBhdXNlQWxsIiwgImZvcmNlUmVtb3ZlIiwgImNoYW5nZVBvc2l0aW9uIiwgInRlbGxTdGF0dXMiLCAiZ2V0VXJpcyIsICJnZXRGaWxlcyIsICJnZXRTZXJ2ZXJzIiwgInRlbGxBY3RpdmUiLCAidGVsbFdhaXRpbmciLCAidGVsbFN0b3BwZWQiLCAiZ2V0T3B0aW9uIiwgImNoYW5nZVVyaSIsICJjaGFuZ2VPcHRpb24iLCAiZ2V0R2xvYmFsT3B0aW9uIiwgImNoYW5nZUdsb2JhbE9wdGlvbiIsICJwdXJnZURvd25sb2FkUmVzdWx0IiwgInJlbW92ZURvd25sb2FkUmVzdWx0IiwgImdldFZlcnNpb24iLCAiZ2V0U2Vzc2lvbkluZm8iLCAic2h1dGRvd24iLCAiZm9yY2VTaHV0ZG93biIsICJnZXRHbG9iYWxTdGF0IiwgInNhdmVTZXNzaW9uIl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kTmFtZSkgewogIEFyaWEyQ2xpZW50LnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgfQoKICAgIHJldHVybiB0aGlzLmNvbm5lY3RQcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHZhciBpZCA9IF90aGlzMy5sYXN0SWQrKzsKCiAgICAgICAgX3RoaXMzLmNhbGxiYWNrc1tpZF0gPSBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgaWYgKGRhdGEuZXJyb3IpIHsKICAgICAgICAgICAgcmVqZWN0KGRhdGEuZXJyb3IpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzb2x2ZShkYXRhLnJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfTsgLy8g5ZCR5ZCO56uv5Y+R5LiA5LiqSlNPTuWvueixoQoKCiAgICAgICAgX3RoaXMzLndlYnNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgIGpzb25ycGM6ICcyLjAnLAogICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgbWV0aG9kOiAiYXJpYTIuIi5jb25jYXQobWV0aG9kTmFtZSksCiAgICAgICAgICBwYXJhbXM6IFsidG9rZW46Ii5jb25jYXQoX3RoaXMzLm9wdGlvbnMuc2VjcmV0KV0uY29uY2F0KGFyZ3MpCiAgICAgICAgfSkpOwogICAgICB9KTsKICAgIH0pOwogIH07Cn0pOyAvLyDmoLnmja7mr4/kuKror7fmsYLov5Tlm57kuIDkuKpwcm9taXNl77yMCgpleHBvcnQgZGVmYXVsdCBBcmlhMkNsaWVudDs="},{"version":3,"sources":["/Users/zhengwen/Desktop/zw/aria2gu/src/aria2-client.js"],"names":["Aria2Client","options","websocket","WebSocket","host","port","connectPromise","Promise","resolve","reject","addEventListener","e","lastId","callbacks","data","JSON","parse","callback","id","close","forEach","methodName","prototype","args","then","error","result","send","stringify","jsonrpc","method","params","secret"],"mappings":";;;;;;IAAMA,W;AACJ,uBAAYC,OAAZ,EAAoB;AAAA;;AAAA;;AAClB,SAAKA,OAAL,GAAeA,OAAf;AACA,SAAKC,SAAL,GAAiB,IAAIC,SAAJ,gBAAsBF,OAAO,CAACG,IAA9B,cAAsCH,OAAO,CAACI,IAA9C,cAAjB,CAFkB,CAGlB;;AACA,SAAKC,cAAL,GAAsB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAkB;AAClD,MAAA,KAAI,CAACP,SAAL,CAAeQ,gBAAf,CAAgC,MAAhC,EAAuC,YAAI;AACzCF,QAAAA,OAAO;AACR,OAFD;;AAGA,MAAA,KAAI,CAACN,SAAL,CAAeQ,gBAAf,CAAgC,OAAhC,EAAwC,UAACC,CAAD,EAAK;AAC3CF,QAAAA,MAAM,CAAC,kBAAD,CAAN;AACD,OAFD;AAGD,KAPqB,CAAtB,CAJkB,CAWhB;;AACF,SAAKG,MAAL,GAAc,CAAd,CAZkB,CAapB;;AACE,SAAKC,SAAL,GAAiB,EAAjB,CAdkB,CAelB;AAGJ;;AACI,SAAKX,SAAL,CAAeQ,gBAAf,CAAgC,SAAhC,EAA0C,UAAAC,CAAC,EAAE;AAC3C,UAAIG,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWL,CAAC,CAACG,IAAb,CAAX;AACA,UAAIG,QAAQ,GAAI,KAAI,CAACJ,SAAL,CAAeC,IAAI,CAACI,EAApB,CAAhB;AACA,aAAO,KAAI,CAACL,SAAL,CAAeC,IAAI,CAACI,EAApB,CAAP;;AAEA,UAAG,OAAOD,QAAP,IAAmB,UAAtB,EAAiC;AAC/BA,QAAAA,QAAQ,CAACH,IAAD,CAAR;AACD;AACF,KARD;AASD;;;;WACD,iBAAO;AACL,aAAO,KAAKR,cAAZ;AACD;;;WACD,iBAAO;AAAA;;AACL,WAAKJ,SAAL,CAAeiB,KAAf;AACA,aAAO,IAAIZ,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAkB;AACnC,QAAA,MAAI,CAACP,SAAL,CAAeQ,gBAAf,CAAgC,OAAhC,EAAwC,YAAI;AAC1CF,UAAAA,OAAO;AACR,SAFD;AAGD,OAJM,CAAP;AAKD;;;;;;AAID,CAAC,QAAD,EACE,YADF,EAEE,UAFF,EAGE,aAHF,EAIE,QAJF,EAKE,OALF,EAME,YANF,EAOE,UAPF,EAQE,eARF,EASE,SATF,EAUE,YAVF,EAWE,aAXF,EAYE,gBAZF,EAaE,YAbF,EAcE,SAdF,EAeE,UAfF,EAgBE,YAhBF,EAiBE,YAjBF,EAkBE,aAlBF,EAmBE,aAnBF,EAoBE,WApBF,EAqBE,WArBF,EAsBE,cAtBF,EAuBE,iBAvBF,EAwBE,oBAxBF,EAyBE,qBAzBF,EA0BE,sBA1BF,EA2BE,YA3BF,EA4BE,gBA5BF,EA6BE,UA7BF,EA8BE,eA9BF,EA+BE,eA/BF,EAgCE,aAhCF,EAiCAY,OAjCA,CAiCQ,UAAAC,UAAU,EAAI;AACtBrB,EAAAA,WAAW,CAACsB,SAAZ,CAAsBD,UAAtB,IAAoC,YAAiB;AAAA;;AAAA,sCAALE,IAAK;AAALA,MAAAA,IAAK;AAAA;;AACnD,WAAO,KAAKjB,cAAL,CAAoBkB,IAApB,CAAyB,YAAI;AAClC,aAAO,IAAIjB,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAkB;AACnC,YAAIS,EAAE,GAAG,MAAI,CAACN,MAAL,EAAT;;AACA,QAAA,MAAI,CAACC,SAAL,CAAeK,EAAf,IAAqB,UAASJ,IAAT,EAAc;AACjC,cAAGA,IAAI,CAACW,KAAR,EAAc;AACZhB,YAAAA,MAAM,CAACK,IAAI,CAACW,KAAN,CAAN;AACD,WAFD,MAEK;AACHjB,YAAAA,OAAO,CAACM,IAAI,CAACY,MAAN,CAAP;AACD;AACF,SAND,CAFmC,CASnC;;;AACA,QAAA,MAAI,CAACxB,SAAL,CAAeyB,IAAf,CAAoBZ,IAAI,CAACa,SAAL,CAAe;AACjCC,UAAAA,OAAO,EAAC,KADyB;AAEjCX,UAAAA,EAAE,EAACA,EAF8B;AAGjCY,UAAAA,MAAM,kBAAWT,UAAX,CAH2B;AAIjCU,UAAAA,MAAM,mBAAW,MAAI,CAAC9B,OAAL,CAAa+B,MAAxB,UAAoCT,IAApC;AAJ2B,SAAf,CAApB;AAMD,OAhBM,CAAP;AAiBD,KAlBM,CAAP;AAmBD,GApBD;AAqBD,CAvDC,E,CAwDF;;AACA,eAAgBvB,WAAhB","sourcesContent":["class Aria2Client{\n  constructor(options){\n    this.options = options\n    this.websocket = new WebSocket(`ws://${options.host}:${options.port}/jsonrpc`) \n    // 只有websocket连接上了才会resolve\n    this.connectPromise = new Promise((resolve,reject)=>{\n      this.websocket.addEventListener('open',()=>{\n        resolve()\n      })\n      this.websocket.addEventListener('error',(e)=>{\n        reject('WS_CONNECT_ERROR')\n      })\n    })// 只考虑连接成功的情况\n    this.lastId = 1\n  // 标记每个请求的ID  如果采用Http，单向传输，每次创建的都是新连接就不用标记\n    this.callbacks = {}\n    // 存放每个请求的回调\n\n   \n// 根据接收到的消息的id属性，调用相应的回调函数\n    this.websocket.addEventListener('message',e=>{\n      var data = JSON.parse(e.data)\n      var callback  = this.callbacks[data.id]\n      delete this.callbacks[data.id]\n\n      if(typeof callback == 'function'){\n        callback(data)\n      }\n    })\n  }\n  ready(){\n    return this.connectPromise\n  }\n  close(){\n    this.websocket.close()\n    return new Promise((resolve,reject)=>{\n      this.websocket.addEventListener('close',()=>{\n        resolve()\n      })\n    })\n  }\n}\n\n\n  [\"addUri\",\n    \"addTorrent\",\n    \"getPeers\",\n    \"addMetalink\",\n    \"remove\",\n    \"pause\",\n    \"forcePause\",\n    \"pauseAll\",\n    \"forcePauseAll\",\n    \"unpause\",\n    \"unpauseAll\",\n    \"forceRemove\",\n    \"changePosition\",\n    \"tellStatus\",\n    \"getUris\",\n    \"getFiles\",\n    \"getServers\",\n    \"tellActive\",\n    \"tellWaiting\",\n    \"tellStopped\",\n    \"getOption\",\n    \"changeUri\",\n    \"changeOption\",\n    \"getGlobalOption\",\n    \"changeGlobalOption\",\n    \"purgeDownloadResult\",\n    \"removeDownloadResult\",\n    \"getVersion\",\n    \"getSessionInfo\",\n    \"shutdown\",\n    \"forceShutdown\",\n    \"getGlobalStat\",\n    \"saveSession\",\n].forEach(methodName => {\n  Aria2Client.prototype[methodName] = function(...args){\n    return this.connectPromise.then(()=>{\n      return new Promise((resolve,reject)=>{\n        var id = this.lastId++\n        this.callbacks[id] = function(data){\n          if(data.error){\n            reject(data.error)\n          }else{\n            resolve(data.result)\n          }\n        }\n        // 向后端发一个JSON对象\n        this.websocket.send(JSON.stringify({\n          jsonrpc:'2.0',\n          id:id,\n          method: `aria2.${methodName}`,\n          params:[`token:${this.options.secret}`,...args]\n        }))\n      })\n    })\n  }\n})\n// 根据每个请求返回一个promise，\nexport default  Aria2Client\n\n\n"]}]}