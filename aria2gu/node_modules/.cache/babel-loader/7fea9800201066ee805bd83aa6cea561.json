{"remainingRequest":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/babel-loader/lib/index.js!/Users/zhengwen/Desktop/zw/aria2gu/node_modules/eslint-loader/index.js??ref--14-0!/Users/zhengwen/Desktop/zw/aria2gu/src/aria2-client.js","dependencies":[{"path":"/Users/zhengwen/Desktop/zw/aria2gu/src/aria2-client.js","mtime":1638689058014},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/babel.config.js","mtime":1637998144475},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/babel-loader/lib/index.js","mtime":1637998138838},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/eslint-loader/index.js","mtime":1637998138707}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvVXNlcnMvemhlbmd3ZW4vRGVza3RvcC96dy9hcmlhMmd1L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheS5qcyI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL1VzZXJzL3poZW5nd2VuL0Rlc2t0b3AvencvYXJpYTJndS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2suanMiOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9Vc2Vycy96aGVuZ3dlbi9EZXNrdG9wL3p3L2FyaWEyZ3Uvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzLmpzIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICIvVXNlcnMvemhlbmd3ZW4vRGVza3RvcC96dy9hcmlhMmd1L25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cy5qcyI7CmltcG9ydCBfY3JlYXRlU3VwZXIgZnJvbSAiL1VzZXJzL3poZW5nd2VuL0Rlc2t0b3AvencvYXJpYTJndS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnN0YXJ0cy13aXRoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5qc29uLnN0cmluZ2lmeS5qcyI7CmltcG9ydCBFdmVudEVtaXR0ZXIgZnJvbSAnZXZlbnRzJzsKCnZhciBBcmlhMkNsaWVudCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0V2ZW50RW1pdHRlcikgewogIF9pbmhlcml0cyhBcmlhMkNsaWVudCwgX0V2ZW50RW1pdHRlcik7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoQXJpYTJDbGllbnQpOwoKICBmdW5jdGlvbiBBcmlhMkNsaWVudChvcHRpb25zKSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFyaWEyQ2xpZW50KTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpOwogICAgX3RoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICBfdGhpcy53ZWJzb2NrZXQgPSBuZXcgV2ViU29ja2V0KCJ3czovLyIuY29uY2F0KG9wdGlvbnMuaG9zdCwgIjoiKS5jb25jYXQob3B0aW9ucy5wb3J0LCAiL2pzb25ycGMiKSk7CiAgICBfdGhpcy5jb25uZWN0UHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgX3RoaXMud2Vic29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ29wZW4nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKCiAgICAgIF90aGlzLndlYnNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmVqZWN0KCdXU19DT05ORUNUSU9OX0VSUk9SJyk7CiAgICAgIH0pOwogICAgfSk7CiAgICBfdGhpcy5sYXN0SWQgPSAxOwogICAgX3RoaXMuY2FsbGJhY2tzID0ge307IC8vIOWtmOaUvuavj+S4quivt+axgueahOWbnuiwg+WHveaVsAoKICAgIF90aGlzLndlYnNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKGUuZGF0YSk7IC8vIOaUtuWIsOeahOa2iOaBr+S4reW4puaciW1ldGhvZOWtl+aute+8jOivtOaYjuaYr+S6i+S7tgoKICAgICAgaWYgKGRhdGEubWV0aG9kICYmIGRhdGEubWV0aG9kLnN0YXJ0c1dpdGgoJ2FyaWEyLm9uJykpIHsKICAgICAgICB2YXIgX3RoaXMyOwoKICAgICAgICAvLyDlnKhjbGllbnTkuIrop6blj5Hnm7jlupTnmoTkuovku7bvvIznm5HlkKznm7jlupTkuovku7bnmoTlnLDmlrnlj6/ku6Xop6blj5Hlm57osIPkuoYKICAgICAgICAvLyDop6blj5HnlKhvbue7keWumueahOebuOW6lOS6i+S7tu+8jOatpOWkhOS6i+S7tuWQjeensOS4jeW4pm9u77yM5omA5Lul5pivc2xpY2UoOCkKICAgICAgICAoX3RoaXMyID0gX3RoaXMpLmVtaXQuYXBwbHkoX3RoaXMyLCBbZGF0YS5tZXRob2Quc2xpY2UoOCldLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZGF0YS5wYXJhbXMpKSk7IC8vIOinpuWPkeeUqCBjbGllbnQub25Eb3dubG9hZFN0YXJ0IOe7keWumueahOebuOW6lOS6i+S7tgogICAgICAgIC8vIOatpOWkhOS6i+S7tuWQjeensOaYr+W4pm9u55qE77yM5omA5Lul5pivc2xpY2UoNikKCgogICAgICAgIHZhciBoYW5kbGVyID0gX3RoaXNbZGF0YS5tZXRob2Quc2xpY2UoNildOwoKICAgICAgICBpZiAodHlwZW9mIGhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIGhhbmRsZXIuYXBwbHkodm9pZCAwLCBfdG9Db25zdW1hYmxlQXJyYXkoZGF0YS5wYXJhbXMpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGNhbGxiYWNrID0gX3RoaXMuY2FsbGJhY2tzW2RhdGEuaWRdOyAvLyDpgJrov4flk43lupTmtojmga/nmoRpZOWcqGNhbGxiYWNrc+mHjOafpeWHuuWvueW6lOivt+axgueahOWbnuiwgwoKICAgICAgICBkZWxldGUgX3RoaXMuY2FsbGJhY2tzW2RhdGEuaWRdOyAvLyDku45jYWxsYmFja3Pph4zliKDpmaTov5nkuKrlm57osIMKCiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBjYWxsYmFjayhkYXRhKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhBcmlhMkNsaWVudCwgW3sKICAgIGtleTogInJlYWR5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWFkeSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdFByb21pc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAiY2xvc2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMud2Vic29ja2V0LmNsb3NlKCk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgX3RoaXMzLndlYnNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdjbG9zZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQXJpYTJDbGllbnQ7Cn0oRXZlbnRFbWl0dGVyKTsKCjsKWyJhZGRVcmkiLCAiYWRkVG9ycmVudCIsICJnZXRQZWVycyIsICJhZGRNZXRhbGluayIsICJyZW1vdmUiLCAicGF1c2UiLCAiZm9yY2VQYXVzZSIsICJwYXVzZUFsbCIsICJmb3JjZVBhdXNlQWxsIiwgInVucGF1c2UiLCAidW5wYXVzZUFsbCIsICJmb3JjZVJlbW92ZSIsICJjaGFuZ2VQb3NpdGlvbiIsICJ0ZWxsU3RhdHVzIiwgImdldFVyaXMiLCAiZ2V0RmlsZXMiLCAiZ2V0U2VydmVycyIsICJ0ZWxsQWN0aXZlIiwgInRlbGxXYWl0aW5nIiwgInRlbGxTdG9wcGVkIiwgImdldE9wdGlvbiIsICJjaGFuZ2VVcmkiLCAiY2hhbmdlT3B0aW9uIiwgImdldEdsb2JhbE9wdGlvbiIsICJjaGFuZ2VHbG9iYWxPcHRpb24iLCAicHVyZ2VEb3dubG9hZFJlc3VsdCIsICJyZW1vdmVEb3dubG9hZFJlc3VsdCIsICJnZXRWZXJzaW9uIiwgImdldFNlc3Npb25JbmZvIiwgInNodXRkb3duIiwgImZvcmNlU2h1dGRvd24iLCAiZ2V0R2xvYmFsU3RhdCIsICJzYXZlU2Vzc2lvbiJdLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZE5hbWUpIHsKICBBcmlhMkNsaWVudC5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5jb25uZWN0UHJvbWlzZS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICB2YXIgaWQgPSBfdGhpczQubGFzdElkKys7CgogICAgICAgIF90aGlzNC5jYWxsYmFja3NbaWRdID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgIGlmIChkYXRhLmVycm9yKSB7CiAgICAgICAgICAgIHJlamVjdChkYXRhLmVycm9yKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc29sdmUoZGF0YS5yZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGlmIChfdGhpczQud2Vic29ja2V0LnJlYWR5U3RhdGUgPT09IFdlYlNvY2tldC5PUEVOKSB7CiAgICAgICAgICBfdGhpczQud2Vic29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICBqc29ucnBjOiAnMi4wJywKICAgICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgICBtZXRob2Q6ICJhcmlhMi4iLmNvbmNhdChtZXRob2ROYW1lKSwKICAgICAgICAgICAgcGFyYW1zOiBbInRva2VuOiIuY29uY2F0KF90aGlzNC5vcHRpb25zLnNlY3JldCldLmNvbmNhdChhcmdzKQogICAgICAgICAgfSkpOwoKICAgICAgICAgIGNvbnNvbGUubG9nKCdhZnRlciBzZW5kJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlamVjdCgnV1NfQ09OTkVDVElPTl9FUlJPUicpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9OyAvLyBBcmlhMkNsaWVudC5wcm90b3R5cGVbbWV0aG9kTmFtZSArICdwb3N0J10gPSBmdW5jdGlvbiAoLi4uYXJncykgewogIC8vICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAvLyAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpCiAgLy8gICAgIHhoci5vcGVuKCdwb3N0JywgYGh0dHA6Ly8ke3RoaXMub3B0aW9ucy5ob3N0fToke3RoaXMub3B0aW9ucy5wb3J0fS9qc29ucnBjYCkKICAvLyAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ2NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi9qc29uJykKICAvLyAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAvLyAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCkKICAvLyAgICAgICBpZiAoZGF0YS5lcnJybykgewogIC8vICAgICAgICAgcmVqZWN0KGRhdGEuZXJyb3IpCiAgLy8gICAgICAgfSBlbHNlIHsKICAvLyAgICAgICAgIHJlc29sdmUoZGF0YS5yZXN1bHQpCiAgLy8gICAgICAgfQogIC8vICAgICB9CiAgLy8gICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KAogIC8vICAgICAgICAgewogIC8vICAgICAgICAgICAgIGpzb25ycGM6ICcyLjAnLAogIC8vICAgICAgICAgICAgIGlkOiB0aGlzLmxhc3RJZCsrLAogIC8vICAgICAgICAgICAgIG1ldGhvZDogYGFyaWEyLiR7bWV0aG9kTmFtZX1gLAogIC8vICAgICAgICAgICAgIHBhcmFtczogWyd0b2tlbjphYmNkZWZnJywgLi4uYXJnc10sCiAgLy8gICAgICAgICB9CiAgLy8gICAgICkpCiAgLy8gICB9KQogIC8vIH0KCn0pOwpleHBvcnQgZGVmYXVsdCBBcmlhMkNsaWVudDs="},{"version":3,"sources":["/Users/zhengwen/Desktop/zw/aria2gu/src/aria2-client.js"],"names":["EventEmitter","Aria2Client","options","websocket","WebSocket","host","port","connectPromise","Promise","resolve","reject","addEventListener","e","lastId","callbacks","data","JSON","parse","method","startsWith","emit","slice","params","handler","callback","id","close","forEach","methodName","prototype","args","then","error","result","readyState","OPEN","send","stringify","jsonrpc","secret","console","log"],"mappings":"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","sourcesContent":["import EventEmitter from 'events'\n\nclass Aria2Client extends EventEmitter {\n  constructor(options) {\n    super()\n    this.options = options\n    this.websocket = new WebSocket(`ws://${options.host}:${options.port}/jsonrpc`)\n\n    this.connectPromise = new Promise((resolve, reject) => {\n      this.websocket.addEventListener('open', () => {\n        resolve()\n      })\n      this.websocket.addEventListener('error', (e) => {\n        reject('WS_CONNECTION_ERROR')\n      })\n    })\n\n    this.lastId = 1\n\n    this.callbacks = {} // 存放每个请求的回调函数\n\n    this.websocket.addEventListener('message', e => {\n      var data = JSON.parse(e.data)\n      // 收到的消息中带有method字段，说明是事件\n      if (data.method && data.method.startsWith('aria2.on')) {\n        // 在client上触发相应的事件，监听相应事件的地方可以触发回调了\n\n        // 触发用on绑定的相应事件，此处事件名称不带on，所以是slice(8)\n        this.emit(data.method.slice(8), ...data.params)\n\n        // 触发用 client.onDownloadStart 绑定的相应事件\n        // 此处事件名称是带on的，所以是slice(6)\n        var handler = this[data.method.slice(6)]\n        if (typeof handler === 'function') {\n          handler(...data.params)\n        }\n      } else {\n        var callback = this.callbacks[data.id] // 通过响应消息的id在callbacks里查出对应请求的回调\n        delete this.callbacks[data.id] // 从callbacks里删除这个回调\n        if (typeof callback == 'function') {\n          callback(data)\n        }\n      }\n    })\n  }\n  ready() {\n    return this.connectPromise\n  }\n  close() {\n    this.websocket.close()\n    return new Promise((resolve, reject) => {\n      this.websocket.addEventListener('close', () => {\n        resolve()\n      })\n    })\n  }\n}\n\n;[\n  \"addUri\",\n  \"addTorrent\",\n  \"getPeers\",\n  \"addMetalink\",\n  \"remove\",\n  \"pause\",\n  \"forcePause\",\n  \"pauseAll\",\n  \"forcePauseAll\",\n  \"unpause\",\n  \"unpauseAll\",\n  \"forceRemove\",\n  \"changePosition\",\n  \"tellStatus\",\n  \"getUris\",\n  \"getFiles\",\n  \"getServers\",\n  \"tellActive\",\n  \"tellWaiting\",\n  \"tellStopped\",\n  \"getOption\",\n  \"changeUri\",\n  \"changeOption\",\n  \"getGlobalOption\",\n  \"changeGlobalOption\",\n  \"purgeDownloadResult\",\n  \"removeDownloadResult\",\n  \"getVersion\",\n  \"getSessionInfo\",\n  \"shutdown\",\n  \"forceShutdown\",\n  \"getGlobalStat\",\n  \"saveSession\"\n].forEach(methodName => {\n  Aria2Client.prototype[methodName] = function (...args) {\n    return this.connectPromise.then(() => {\n      return new Promise((resolve, reject) => {\n        var id = this.lastId++\n        this.callbacks[id] = function(data) {\n          if (data.error) {\n            reject(data.error)\n          } else {\n            resolve(data.result)\n          }\n        }\n        if (this.websocket.readyState === WebSocket.OPEN) {\n          this.websocket.send(JSON.stringify({\n            jsonrpc: '2.0',\n            id: id,\n            method: `aria2.${methodName}`,\n            params: [`token:${this.options.secret}`, ...args]\n          }))\n          console.log('after send')\n        } else {\n          reject('WS_CONNECTION_ERROR')\n        }\n      })\n    })\n  }\n\n  // Aria2Client.prototype[methodName + 'post'] = function (...args) {\n  //   return new Promise((resolve, reject) => {\n  //     var xhr = new XMLHttpRequest()\n  //     xhr.open('post', `http://${this.options.host}:${this.options.port}/jsonrpc`)\n  //     xhr.setRequestHeader('content-type', 'application/json')\n  //     xhr.onload = function () {\n  //       var data = JSON.parse(xhr.responseText)\n  //       if (data.errro) {\n  //         reject(data.error)\n  //       } else {\n  //         resolve(data.result)\n  //       }\n  //     }\n  //     xhr.send(JSON.stringify(\n  //         {\n  //             jsonrpc: '2.0',\n  //             id: this.lastId++,\n  //             method: `aria2.${methodName}`,\n  //             params: ['token:abcdefg', ...args],\n  //         }\n  //     ))\n  //   })\n  // }\n})\n\nexport default Aria2Client\n"]}]}