{"remainingRequest":"/Users/zhengwen/aria2gu/node_modules/babel-loader/lib/index.js!/Users/zhengwen/aria2gu/node_modules/eslint-loader/index.js??ref--14-0!/Users/zhengwen/aria2gu/src/aria2-client.js","dependencies":[{"path":"/Users/zhengwen/aria2gu/src/aria2-client.js","mtime":1638159252487},{"path":"/Users/zhengwen/aria2gu/babel.config.js","mtime":1637998144475},{"path":"/Users/zhengwen/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/aria2gu/node_modules/babel-loader/lib/index.js","mtime":1637998138838},{"path":"/Users/zhengwen/aria2gu/node_modules/eslint-loader/index.js","mtime":1637998138707}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvemhlbmd3ZW4vYXJpYTJndS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2suanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi5zdHJpbmdpZnkuanMiOwoKLy8gaW1wb3J0IHsgcmVqZWN0IH0gZnJvbSAiY29yZS1qcy9mbi9wcm9taXNlIgp2YXIgQXJpYTJDbGllbnQgPSBmdW5jdGlvbiBBcmlhMkNsaWVudChvcHRpb25zKSB7CiAgdmFyIF90aGlzID0gdGhpczsKCiAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFyaWEyQ2xpZW50KTsKCiAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICB0aGlzLndlYnNvY2tldCA9IG5ldyBXZWJTb2NrZXQoIndzOi8vIi5jb25jYXQob3B0aW9ucy5ob3N0LCAiOiIpLmNvbmNhdChvcHRpb25zLnBvcnQsICIvanNvbnJwYyIpKTsKICB0aGlzLmNvbm5lY3RQcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgIF90aGlzLndlYnNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdvcGVuJywgZnVuY3Rpb24gKCkgewogICAgICByZXNvbHZlKCk7CiAgICB9KTsKICB9KTsgLy8g5Y+q6ICD6JmR6L+e5o6l5oiQ5Yqf55qE5oOF5Ya1CgogIHRoaXMubGFzdElkID0gMTsKICB0aGlzLmNhbGxiYWNrcyA9IHt9OyAvLyDlrZjmlL7mr4/kuKror7fmsYLnmoTlm57osIMKCiAgdGhpcy53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CiAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoZS5kYXRhKTsKICAgIHZhciBjYWxsYmFjayA9IF90aGlzLmNhbGxiYWNrc1tkYXRhLmlkXTsKICAgIGRlbGV0ZSBfdGhpcy5jYWxsYmFja3NbZGF0YS5pZF07CgogICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PSAnZnVuY3Rpb24nKSB7CiAgICAgIGNhbGxiYWNrKGRhdGEpOwogICAgfQogIH0pOwp9OyAvLyAgIHNlbmQob2JqLGNhbGxiYWNrKXsKLy8gICAgIG9iai5pZCA9IHRoaXMubGFzdElkKysKLy8gICAgIG9iai5qc29ucnBjID0gJzIuMCcKLy8gICAgIHRoaXMuY2FsYmFja3Nbb2JqLmlkXSA9IGZ1bmN0aW9uKGRhdGEpe30KLy8gICAgIHRoaXMud2Vic29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkob2JqKSkKLy8gICB9Ci8vIH0KCgpbImFkZFVyaSIsICJhZGRUb3JyZW50IiwgImdldFBlZXJzIiwgImFkZE1ldGFsaW5rIiwgInJlbW92ZSIsICJwYXVzZSIsICJmb3JjZVBhdXNlIiwgInBhdXNlQWxsIiwgImZvcmNlUGF1c2VBbGwiLCAidW5wYXVzZSIsICJ1bnBhdXNlQWxsIiwgImZvcmNlUmVtb3ZlIiwgImNoYW5nZVBvc2l0aW9uIiwgInRlbGxTdGF0dXMiLCAiZ2V0VXJpcyIsICJnZXRGaWxlcyIsICJnZXRTZXJ2ZXJzIiwgInRlbGxBY3RpdmUiLCAidGVsbFdhaXRpbmciLCAidGVsbFN0b3BwZWQiLCAiZ2V0T3B0aW9uIiwgImNoYW5nZVVyaSIsICJjaGFuZ2VPcHRpb24iLCAiZ2V0R2xvYmFsT3B0aW9uIiwgImNoYW5nZUdsb2JhbE9wdGlvbiIsICJwdXJnZURvd25sb2FkUmVzdWx0IiwgInJlbW92ZURvd25sb2FkUmVzdWx0IiwgImdldFZlcnNpb24iLCAiZ2V0U2Vzc2lvbkluZm8iLCAic2h1dGRvd24iLCAiZm9yY2VTaHV0ZG93biIsICJnZXRHbG9iYWxTdGF0IiwgInNhdmVTZXNzaW9uIl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kTmFtZSkgewogIEFyaWEyQ2xpZW50LnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgfQoKICAgIHJldHVybiB0aGlzLmNvbm5lY3RQcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAvLyDlj6rmnIljb25uZWN0UHJvbWlzZei/nuaOpeS4iuS6huaJjeaJp+ihjAogICAgICB2YXIgaWQgPSBfdGhpczIubGFzdElkKys7CgogICAgICBfdGhpczIuY2FsbGJhY2tzW2lkXSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgaWYgKGRhdGEuZXJyb3IpIHsKICAgICAgICAgIHJlamVjdChkYXRhLmVycm9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzb2x2ZShkYXRhLnJlc3VsdCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgX3RoaXMyLndlYnNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICBqc29ucnBjOiAnMi4wJywKICAgICAgICBpZDogaWQsCiAgICAgICAgbWV0aG9kOiAiYXJpYTIuIi5jb25jYXQobWV0aG9kTmFtZSksCiAgICAgICAgcGFyYW1zOiBbInRva2VuOiIuY29uY2F0KF90aGlzMi5vcHRpb25zLnNlY3JldCldLmNvbmNhdChhcmdzKQogICAgICB9KSk7CiAgICB9KTsKICB9Owp9KTsKZXhwb3J0IGRlZmF1bHQgQXJpYTJDbGllbnQ7"},{"version":3,"sources":["/Users/zhengwen/aria2gu/src/aria2-client.js"],"names":["Aria2Client","options","websocket","WebSocket","host","port","connectPromise","Promise","resolve","addEventListener","lastId","callbacks","e","data","JSON","parse","callback","id","forEach","methodName","prototype","args","then","error","reject","result","send","stringify","jsonrpc","method","params","secret"],"mappings":";;;;;AAAA;IAEMA,W,GACJ,qBAAYC,OAAZ,EAAoB;AAAA;;AAAA;;AAClB,OAAKA,OAAL,GAAeA,OAAf;AACA,OAAKC,SAAL,GAAiB,IAAIC,SAAJ,gBAAsBF,OAAO,CAACG,IAA9B,cAAsCH,OAAO,CAACI,IAA9C,cAAjB;AACA,OAAKC,cAAL,GAAsB,IAAIC,OAAJ,CAAY,UAAAC,OAAO,EAAG;AAC1C,IAAA,KAAI,CAACN,SAAL,CAAeO,gBAAf,CAAgC,MAAhC,EAAuC,YAAI;AACzCD,MAAAA,OAAO;AACR,KAFD;AAGD,GAJqB,CAAtB,CAHkB,CAOhB;;AACF,OAAKE,MAAL,GAAc,CAAd;AAEA,OAAKC,SAAL,GAAiB,EAAjB,CAVkB,CAWlB;;AAIA,OAAKT,SAAL,CAAeO,gBAAf,CAAgC,SAAhC,EAA0C,UAAAG,CAAC,EAAE;AAC3C,QAAIC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWH,CAAC,CAACC,IAAb,CAAX;AACA,QAAIG,QAAQ,GAAI,KAAI,CAACL,SAAL,CAAeE,IAAI,CAACI,EAApB,CAAhB;AACA,WAAO,KAAI,CAACN,SAAL,CAAeE,IAAI,CAACI,EAApB,CAAP;;AAEA,QAAG,OAAOD,QAAP,IAAmB,UAAtB,EAAiC;AAC/BA,MAAAA,QAAQ,CAACH,IAAD,CAAR;AACD;AACF,GARD;AASD,C,EAEH;AACA;AACA;AAEA;AACA;AACA;AACA;;;AAEE,CAAC,QAAD,EACE,YADF,EAEE,UAFF,EAGE,aAHF,EAIE,QAJF,EAKE,OALF,EAME,YANF,EAOE,UAPF,EAQE,eARF,EASE,SATF,EAUE,YAVF,EAWE,aAXF,EAYE,gBAZF,EAaE,YAbF,EAcE,SAdF,EAeE,UAfF,EAgBE,YAhBF,EAiBE,YAjBF,EAkBE,aAlBF,EAmBE,aAnBF,EAoBE,WApBF,EAqBE,WArBF,EAsBE,cAtBF,EAuBE,iBAvBF,EAwBE,oBAxBF,EAyBE,qBAzBF,EA0BE,sBA1BF,EA2BE,YA3BF,EA4BE,gBA5BF,EA6BE,UA7BF,EA8BE,eA9BF,EA+BE,eA/BF,EAgCE,aAhCF,EAiCAK,OAjCA,CAiCQ,UAAAC,UAAU,EAAI;AACtBnB,EAAAA,WAAW,CAACoB,SAAZ,CAAsBD,UAAtB,IAAoC,YAAiB;AAAA;;AAAA,sCAALE,IAAK;AAALA,MAAAA,IAAK;AAAA;;AACnD,WAAO,KAAKf,cAAL,CAAoBgB,IAApB,CAAyB,YAAI;AAClC;AACA,UAAIL,EAAE,GAAG,MAAI,CAACP,MAAL,EAAT;;AACA,MAAA,MAAI,CAACC,SAAL,CAAeM,EAAf,IAAqB,UAASJ,IAAT,EAAc;AACjC,YAAGA,IAAI,CAACU,KAAR,EAAc;AACZC,UAAAA,MAAM,CAACX,IAAI,CAACU,KAAN,CAAN;AACD,SAFD,MAEK;AACHf,UAAAA,OAAO,CAACK,IAAI,CAACY,MAAN,CAAP;AACD;AACF,OAND;;AAOA,MAAA,MAAI,CAACvB,SAAL,CAAewB,IAAf,CAAoBZ,IAAI,CAACa,SAAL,CAAe;AACjCC,QAAAA,OAAO,EAAC,KADyB;AAEjCX,QAAAA,EAAE,EAACA,EAF8B;AAGjCY,QAAAA,MAAM,kBAAWV,UAAX,CAH2B;AAIjCW,QAAAA,MAAM,mBAAW,MAAI,CAAC7B,OAAL,CAAa8B,MAAxB,UAAoCV,IAApC;AAJ2B,OAAf,CAApB;AAMD,KAhBM,CAAP;AAiBD,GAlBD;AAmBD,CArDC;AAuDF,eAAgBrB,WAAhB","sourcesContent":["// import { reject } from \"core-js/fn/promise\"\n\nclass Aria2Client{\n  constructor(options){\n    this.options = options\n    this.websocket = new WebSocket(`ws://${options.host}:${options.port}/jsonrpc`)\n    this.connectPromise = new Promise(resolve =>{\n      this.websocket.addEventListener('open',()=>{\n        resolve()\n      })\n    })// 只考虑连接成功的情况\n    this.lastId = 1\n\n    this.callbacks = {}\n    // 存放每个请求的回调\n\n   \n\n    this.websocket.addEventListener('message',e=>{\n      var data = JSON.parse(e.data)\n      var callback  = this.callbacks[data.id]\n      delete this.callbacks[data.id]\n\n      if(typeof callback == 'function'){\n        callback(data)\n      }\n    })\n  }\n}\n//   send(obj,callback){\n//     obj.id = this.lastId++\n//     obj.jsonrpc = '2.0'\n\n//     this.calbacks[obj.id] = function(data){}\n//     this.websocket.send(JSON.stringify(obj))\n//   }\n// }\n\n  [\"addUri\",\n    \"addTorrent\",\n    \"getPeers\",\n    \"addMetalink\",\n    \"remove\",\n    \"pause\",\n    \"forcePause\",\n    \"pauseAll\",\n    \"forcePauseAll\",\n    \"unpause\",\n    \"unpauseAll\",\n    \"forceRemove\",\n    \"changePosition\",\n    \"tellStatus\",\n    \"getUris\",\n    \"getFiles\",\n    \"getServers\",\n    \"tellActive\",\n    \"tellWaiting\",\n    \"tellStopped\",\n    \"getOption\",\n    \"changeUri\",\n    \"changeOption\",\n    \"getGlobalOption\",\n    \"changeGlobalOption\",\n    \"purgeDownloadResult\",\n    \"removeDownloadResult\",\n    \"getVersion\",\n    \"getSessionInfo\",\n    \"shutdown\",\n    \"forceShutdown\",\n    \"getGlobalStat\",\n    \"saveSession\",\n].forEach(methodName => {\n  Aria2Client.prototype[methodName] = function(...args){\n    return this.connectPromise.then(()=>{\n      // 只有connectPromise连接上了才执行\n      var id = this.lastId++\n      this.callbacks[id] = function(data){\n        if(data.error){\n          reject(data.error)\n        }else{\n          resolve(data.result)\n        }\n      }\n      this.websocket.send(JSON.stringify({\n        jsonrpc:'2.0',\n        id:id,\n        method: `aria2.${methodName}`,\n        params:[`token:${this.options.secret}`,...args]\n      }))\n    })\n  }\n})\n\nexport default  Aria2Client\n\n\n"]}]}