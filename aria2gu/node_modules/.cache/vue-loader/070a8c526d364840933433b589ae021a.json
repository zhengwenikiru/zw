{"remainingRequest":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhengwen/Desktop/zw/aria2gu/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhengwen/Desktop/zw/aria2gu/src/App.vue","mtime":1638689792064},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/babel-loader/lib/index.js","mtime":1637998138838},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js","mtime":1637998138883}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBBcmlhMkNsaWVudCBmcm9tICcuL2FyaWEyLWNsaWVudC5qcycKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgdmFyIHNlcnZlcnMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhcmlhMlNlcnZlcnMnKSkgfHwgW10KICAgIHJldHVybiB7CiAgICAgIGdsb2JhbFN0YXQ6IHt9LAogICAgICBzZXJ2ZXJzOiBzZXJ2ZXJzLAogICAgICBzZWxlY3RlZFNlcnZlcjogbnVsbCwKICAgICAgY29ubmVjdGlvblN0YXR1czogJ+i/nuaOpeS4rS4uLicsCiAgICAgIGFyaWEyOiBudWxsLAogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgc3dpdGNoU2VydmVyKCkgewogICAgICBjb25zb2xlLmxvZygnc3dpdGNoIHNlcnZlcicpCiAgICAgIGNvbnNvbGUubG9nKCflhbPpl63njrDmnInmnI3liqHlmaguLi4nKQogICAgICB0aGlzLmFyaWEyPy5jbG9zZSgpCgogICAgICB0aGlzLmdsb2JhbFN0YXQgPSB7fQoKICAgICAgY29uc29sZS5sb2coJ+i/nuaOpeaWsOeahOacjeWKoeWZqC4uLicpCiAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyA9ICfov57mjqXkuK0uLi4nCiAgICAgIHZhciBhcmlhMiA9IG5ldyBBcmlhMkNsaWVudCh0aGlzLnNlbGVjdGVkU2VydmVyKQoKICAgICAgdGhpcy5hcmlhMiA9IGFyaWEyCgogICAgICB0cnkgewogICAgICAgIGF3YWl0IGFyaWEyLnJlYWR5KCkKICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMgPSAn5bey6L+e5o6lJwogICAgICB9IGNhdGNoKGUpIHsKICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMgPSAn6L+e5o6l5aSx6LSlJwogICAgICB9CiAgICB9LAogICAgc3RhcnRJbnRlcnZhbFVwZGF0ZSgpIHsKICAgICAgdGhpcy5pbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLmdsb2JhbFN0YXQgPSBhd2FpdCB0aGlzLmFyaWEyLmdldEdsb2JhbFN0YXQoKQogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgaWYgKGUgPT0gJ1dTX0NPTk5FQ1RJT05fRVJST1InKSB7CiAgICAgICAgICAgIHRoaXMuJGFsZXJ0KCfov57mjqXlpLHotKUnKQogICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmludGVydmFsSWQpCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElkKQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgMzAwMCkKICAgICAgY29uc29sZS5sb2coJ2FwcCBpbnRlcnZhbCBpZCcsIHRoaXMuaW50ZXJ2YWxJZCkKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICBjb25zb2xlLmxvZygnYXBwIGNyZWF0ZWQnKQogICAgdGhpcy5zZWxlY3RlZFNlcnZlciA9IHRoaXMuc2VydmVyc1swXQogICAgdGhpcy5zd2l0Y2hTZXJ2ZXIoKQogIH0sCiAgYXN5bmMgbW91bnRlZCgpIHsKCiAgICB0aGlzLmFyaWEyLm9uKCdEb3dubG9hZFN0YXJ0JywgYXN5bmMgdGFzayA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCfmnInku7vliqHlvIDlp4vkuoYnLCB0YXNrLmdpZCkKICAgICAgdGhpcy5nbG9iYWxTdGF0ID0gYXdhaXQgdGhpcy5hcmlhMi5nZXRHbG9iYWxTdGF0KCkKICAgIH0pCiAgICB0aGlzLmFyaWEyLm9uKCdEb3dubG9hZENvbXBsZXRlJywgYXN5bmMgdGFzayA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCfmnInku7vliqHlrozmiJDkuoYnLCB0YXNrLmdpZCkKICAgICAgdGhpcy5nbG9iYWxTdGF0ID0gYXdhaXQgdGhpcy5hcmlhMi5nZXRHbG9iYWxTdGF0KCkKICAgIH0pCgoKICAgIHRyeSB7CiAgICAgIHRoaXMuZ2xvYmFsU3RhdCA9IGF3YWl0IHRoaXMuYXJpYTIuZ2V0R2xvYmFsU3RhdCgpCiAgICAgIHRoaXMuc3RhcnRJbnRlcnZhbFVwZGF0ZSgpCgogICAgfSBjYXRjaChlKSB7CiAgICAgIGlmIChlID09ICdXU19DT05ORUNUSU9OX0VSUk9SJykgewogICAgICAgIHRoaXMuJGFsZXJ0KCfov57mjqXlpLHotKUnKQogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IGUKICAgICAgfQogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIGFzeW5jIGFyaWEyKCkgewogICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCkKICAgICAgdGhpcy5nbG9iYWxTdGF0ID0gYXdhaXQgdGhpcy5hcmlhMi5nZXRHbG9iYWxTdGF0KCkKICAgICAgdGhpcy5zdGFydEludGVydmFsVXBkYXRlKCkKICAgIH0KICB9LAogIGJlZm9yZURlc3Ryb3koKSB7CiAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCkKICB9Cn0K"},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<style lang=\"less\">\nhtml, body {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n#app {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-flow: column;\n}\n.main {\n  flex-grow: 1;\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  // text-align: center;\n  color: #2c3e50;\n  display: flex;\n  h2 {\n    margin: 0;\n  }\n}\n\n#nav {\n  width: 120px;\n  border-right: 1px solid;\n  padding: 10px;\n  flex-grow: 0;\n  flex-shrink: 0;\n\n  a {\n    display: block;\n    font-weight: bold;\n    color: #2c3e50;\n\n    &.router-link-exact-active {\n      color: #42b983;\n    }\n  }\n}\n.global-stat {\n  text-align: right;\n}\n</style>\n<template>\n  <div id=\"app\">\n    <div class=\"main\">\n      <div id=\"nav\">\n        <select v-model=\"selectedServer\" @change=\"switchServer\">\n          <option v-for=\"(server, idx) of servers\" :value=\"server\" :key=\"idx\">{{ server.name || (server.host + ':' + server.port) }}</option>\n        </select>\n        {{ connectionStatus }}\n        <router-link to=\"/\">正在下载({{ -(-globalStat.numWaiting - globalStat.numActive) }})</router-link>\n        <router-link to=\"/completed\">已完成({{ globalStat.numStopped }})</router-link>\n        <router-link to=\"/new\">新建下载</router-link>\n        <router-link to=\"/settings\">设置</router-link>\n        <router-link to=\"/servers\">服务器列表</router-link>\n      </div>\n      <router-view :aria2=\"aria2\" @servers-changed=\"servers = $event\"/>\n    </div>\n    <div class=\"global-stat\">全局上传速度: {{  globalStat.uploadSpeed  }} 全局下载速度: {{globalStat.downloadSpeed}}</div>\n  </div>\n</template>\n<script>\nimport Aria2Client from './aria2-client.js'\n\nexport default {\n  data() {\n    var servers = JSON.parse(localStorage.getItem('aria2Servers')) || []\n    return {\n      globalStat: {},\n      servers: servers,\n      selectedServer: null,\n      connectionStatus: '连接中...',\n      aria2: null,\n    }\n  },\n  methods: {\n    async switchServer() {\n      console.log('switch server')\n      console.log('关闭现有服务器...')\n      this.aria2?.close()\n\n      this.globalStat = {}\n\n      console.log('连接新的服务器...')\n      this.connectionStatus = '连接中...'\n      var aria2 = new Aria2Client(this.selectedServer)\n\n      this.aria2 = aria2\n\n      try {\n        await aria2.ready()\n        this.connectionStatus = '已连接'\n      } catch(e) {\n        this.connectionStatus = '连接失败'\n      }\n    },\n    startIntervalUpdate() {\n      this.intervalId = setInterval(async () => {\n        try {\n          this.globalStat = await this.aria2.getGlobalStat()\n        } catch(e) {\n          if (e == 'WS_CONNECTION_ERROR') {\n            this.$alert('连接失败')\n            console.log(this.intervalId)\n            clearInterval(this.intervalId)\n          } else {\n            throw e\n          }\n        }\n      }, 3000)\n      console.log('app interval id', this.intervalId)\n    }\n  },\n  created() {\n    console.log('app created')\n    this.selectedServer = this.servers[0]\n    this.switchServer()\n  },\n  async mounted() {\n\n    this.aria2.on('DownloadStart', async task => {\n      console.log('有任务开始了', task.gid)\n      this.globalStat = await this.aria2.getGlobalStat()\n    })\n    this.aria2.on('DownloadComplete', async task => {\n      console.log('有任务完成了', task.gid)\n      this.globalStat = await this.aria2.getGlobalStat()\n    })\n\n\n    try {\n      this.globalStat = await this.aria2.getGlobalStat()\n      this.startIntervalUpdate()\n\n    } catch(e) {\n      if (e == 'WS_CONNECTION_ERROR') {\n        this.$alert('连接失败')\n      } else {\n        throw e\n      }\n    }\n  },\n  watch: {\n    async aria2() {\n      clearInterval(this.intervalId)\n      this.globalStat = await this.aria2.getGlobalStat()\n      this.startIntervalUpdate()\n    }\n  },\n  beforeDestroy() {\n    clearInterval(this.intervalId)\n  }\n}\n</script>\n"]}]}