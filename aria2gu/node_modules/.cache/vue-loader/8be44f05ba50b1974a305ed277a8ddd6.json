{"remainingRequest":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhengwen/Desktop/zw/aria2gu/src/views/Downloading.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhengwen/Desktop/zw/aria2gu/src/views/Downloading.vue","mtime":1638693201389},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/babel-loader/lib/index.js","mtime":1637998138838},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js","mtime":1637998138883}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIEAgaXMgYW4gYWxpYXMgdG8gL3NyYwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJEb3dubG9hZGluZyIsCiAgcHJvcHM6IFsnYXJpYTInXSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdGFza3M6IFtdLAogICAgICBzZWxlY3RlZDogW10sCiAgICAgIHNlYXJjaFRleHQ6ICcnLAogICAgICBzb3J0Q29sdW1uOiAnJywKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICB2aXNpYmxlVGFza3MoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaFRleHQgPT0gJycpIHsKICAgICAgICByZXR1cm4gdGhpcy50YXNrcwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLnRhc2tzLmZpbHRlcihpdCA9PiB7CiAgICAgICAgICByZXR1cm4gaXQuZmlsZXNbMF0ucGF0aC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRoaXMuc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpKQogICAgICAgIH0pCiAgICAgIH0KICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBhcmlhMigpIHsKICAgICAgdGhpcy50YXNrcyA9IFtdCiAgICAgIHRoaXMudXBkYXRlTGlzdCgpCiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5hcmlhMi5vbignRG93bmxvYWRTdGFydCcsICgpID0+IHsKICAgICAgdGhpcy51cGRhdGVMaXN0KCkKICAgIH0pCiAgICB0aGlzLmFyaWEyLm9uKCdEb3dubG9hZENvbXBsZXRlJywgKCkgPT4gewogICAgICB0aGlzLnVwZGF0ZUxpc3QoKQogICAgfSkKCiAgICB0aGlzLmludGVydmFsSWQgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVMaXN0KCkKICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgaWYgKGUgPT0gJ1dTX0NPTk5FQ1RJT05fRVJST1InKSB7CiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgZQogICAgICAgIH0KICAgICAgfQogICAgfSwgMTAwKQogIH0sCiAgbWV0aG9kczogewogICAgc29ydENoYW5nZSh7IGNvbHVtbiwgcHJvcCwgb3JkZXIgfSkgewogICAgICB0aGlzLnNvcnRDb2x1bW4gPSBjb2x1bW4KICAgIH0sCiAgICBnZXRTcGVlZChyb3cpIHsKICAgICAgLy8gY29uc29sZS5sb2coYXJncykKICAgICAgcmV0dXJuIChyb3cuY29tcGxldGVkTGVuZ3RoIC8gcm93LnRvdGFsTGVuZ3RoICogMTAwKS50b0ZpeGVkKDIpICsgJyUnCiAgICB9LAogICAgLy8gZ29EZXRhaWwodGFzaykgewogICAgLy8gICB0aGlzLiRyb3V0ZXIucHVzaCgnL3Rhc2svJyArIHRhc2suZ2lkKQogICAgLy8gfSwKICAgIGFzeW5jIHVwZGF0ZUxpc3QoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdGhpcy50YXNrcyA9IFsKICAgICAgICAgIC4uLmF3YWl0IHRoaXMuYXJpYTIudGVsbEFjdGl2ZSgpLAogICAgICAgICAgLi4uYXdhaXQgdGhpcy5hcmlhMi50ZWxsV2FpdGluZygwLCAxMDApCiAgICAgICAgXQogICAgICB9IGNhdGNoKGUpIHsKICAgICAgICB0aGlzLnRhc2tzID0gW10KICAgICAgICB0aHJvdyBlCiAgICAgIH0KICAgIH0sCiAgICAvLyDlr7npgInkuK3nmoTku7vliqHmiafooYzmn5Dnp43mk43kvZzvvJrlvIDlp4vvvIzmmoLlgZzvvIzliKDpmaQKICAgIGFzeW5jIGV4ZWNTZWxlY3RlZChhY3Rpb24pIHsKICAgICAgaWYgKGFjdGlvbiA9PSAncmVtb3ZlJykgewogICAgICAgIHRyeSB7CiAgICAgICAgICBhd2FpdCB0aGlzLiRjb25maXJtKCfnoa7lrprliKDpmaTlkJc/JykKICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHNlbGVjdGVkVGFzayA9IHRoaXMudGFza3MuZmlsdGVyKHRhc2sgPT4gewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkLmluY2x1ZGVzKHRhc2suZ2lkKQogICAgICB9KQogICAgICBmb3IgKGxldCB0YXNrIG9mIHNlbGVjdGVkVGFzaykgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoYWN0aW9uID09ICdwYXVzZScgJiYgdGFzay5zdGF0dXMgPT0gJ3BhdXNlZCcpIHsKICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIH0KICAgICAgICAgIGlmIChhY3Rpb24gPT0gJ3VucGF1c2UnICYmIHRhc2suc3RhdHVzID09ICdhY3RpdmUnKSB7CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICB9CiAgICAgICAgICBhd2FpdCB0aGlzLmFyaWEyW2FjdGlvbl0odGFzay5naWQpCiAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICB0aGlzLiRhbGVydChlLm1lc3NhZ2UpLnRoZW4oKCkgPT4gewogICAgICAgICAgICBjb25zb2xlLmxvZygnb2tra2trJykKICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMudXBkYXRlTGlzdCgpCiAgICB9LAogICAgc2VsZWN0QWxsKCkgewogICAgICBpZiAodGhpcy5zZWxlY3RlZC5sZW5ndGggPT0gdGhpcy50YXNrcy5sZW5ndGgpIHsKICAgICAgICB0aGlzLnNlbGVjdGVkID0gW10KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNlbGVjdGVkID0gdGhpcy50YXNrcy5tYXAoaXQgPT4gaXQuZ2lkKQogICAgICB9CiAgICB9LAogICAgdG9nZ2xlU2VsZWN0KHRhc2spIHsKICAgICAgdmFyIGlkeCA9IHRoaXMuc2VsZWN0ZWQuaW5kZXhPZih0YXNrLmdpZCkKCiAgICAgIGlmIChpZHggPT0gLTEpIHsKICAgICAgICB0aGlzLnNlbGVjdGVkLnB1c2godGFzay5naWQpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZWxlY3RlZC5zcGxpY2UoaWR4LCAxKQogICAgICB9CiAgICB9LAogICAgZ2V0RmlsZW5hbWUodGFzaykgewogICAgICBpZiAodGFzay5maWxlcz8uWzBdLnBhdGgpIHsKICAgICAgICByZXR1cm4gdGFzay5maWxlc1swXS5wYXRoLnNwbGl0KCcvJykuYXQoLTEpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRhc2suZmlsZXM/LnVyaXM/LlswXT8udXJpLnNwbGl0KCcvJykuYXQoLTEpID8/ICfmnKrnn6UnCiAgICAgIH0KICAgIH0sCiAgICBnZXRQZXJjZW50KHRhc2spIHsKICAgICAgaWYgKHRhc2suY29tcGxldGVkTGVuZ3RoID09IDApIHsKICAgICAgICByZXR1cm4gMAogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAodGFzay5jb21wbGV0ZWRMZW5ndGggLyB0YXNrLnRvdGFsTGVuZ3RoICogMTAwKSB8fGZpeGVkICsnJScKICAgICAgfQogICAgfSwKICB9LAogIGJlZm9yZURlc3Ryb3koKSB7CiAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCkKICB9LAogIGNvbXBvbmVudHM6IHsKCiAgfSwKfTsK"},{"version":3,"sources":["Downloading.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"Downloading.vue","sourceRoot":"src/views","sourcesContent":["<style lang=\"less\" scoped>\n  ul {\n    list-style: none;\n  }\n  li {\n    /* display: flex; */\n    cursor: pointer;\n    &.selected {\n      background-color: #ddd;\n    }\n    &:hover {\n      background-color: #eee;\n    }\n  }\n</style>\n<template>\n  <div class=\"downloading\">\n    <h2>正在下载</h2>\n    <div>\n      <button @click=\"execSelected('pause')\">暂停</button>\n      <button @click=\"execSelected('unpause')\">开始</button>\n      <button @click=\"execSelected('remove')\">删除</button>\n      <button @click=\"selectAll\">全选</button>\n      搜索: <input type=\"text\" v-model=\"searchText\"/>\n    </div>\n    <ul>\n      <li v-for=\"task of visibleTasks\" :class=\"{selected: selected.includes(task.gid)}\" :key=\"task.gid\" @click=\"toggleSelect(task)\">\n        <input type=\"checkbox\" :checked=\"selected.includes(task.gid)\" >\n        <span>{{ getFilename(task) }}</span>\n        |\n        <span>{{ getPercent(task) }}</span>\n        |\n        <span>{{ task.downloadSpeed / 1024 | fixed }}k/s</span>\n        |\n        <span>{{ task.status }}</span>\n        |\n        <!-- <button @click.stop=\"goDetail(task)\">详情</button> -->\n        <router-link @click.native.stop :to=\"{name: 'taskDetail', params: {gid: task.gid}}\">详情</router-link>\n      </li>\n    </ul>\n\n    <div>当前排序列：{{ sortColumn.label }} - {{ sortColumn.order }}</div>\n    <el-table\n      @sort-change=\"sortChange\"\n      :data=\"visibleTasks\"\n      style=\"width: 100%\">\n      <el-table-column\n        prop=\"gid\"\n        label=\"名称\"\n        sortable>\n      </el-table-column>\n      <el-table-column\n        :formatter=\"getPercent\"\n        label=\"进度\"\n        sortable>\n      </el-table-column>\n      <el-table-column\n        :formatter=\"getSpeed\"\n        label=\"速度\"\n        sortable>\n      </el-table-column>\n      <el-table-column\n        prop=\"status\"\n        label=\"状态\"\n        sortable>\n      </el-table-column>\n    </el-table>\n\n\n  </div>\n</template>\n\n<script>\n// @ is an alias to /src\n\nexport default {\n  name: \"Downloading\",\n  props: ['aria2'],\n  data() {\n    return {\n      tasks: [],\n      selected: [],\n      searchText: '',\n      sortColumn: '',\n    }\n  },\n  computed: {\n    visibleTasks() {\n      if (this.searchText == '') {\n        return this.tasks\n      } else {\n        return this.tasks.filter(it => {\n          return it.files[0].path.toLowerCase().includes(this.searchText.toLowerCase())\n        })\n      }\n    }\n  },\n  watch: {\n    aria2() {\n      this.tasks = []\n      this.updateList()\n    }\n  },\n  mounted() {\n    this.aria2.on('DownloadStart', () => {\n      this.updateList()\n    })\n    this.aria2.on('DownloadComplete', () => {\n      this.updateList()\n    })\n\n    this.intervalId = setInterval(async () => {\n      try {\n        await this.updateList()\n      } catch(e) {\n        if (e == 'WS_CONNECTION_ERROR') {\n          clearInterval(this.intervalId)\n        } else {\n          throw e\n        }\n      }\n    }, 100)\n  },\n  methods: {\n    sortChange({ column, prop, order }) {\n      this.sortColumn = column\n    },\n    getSpeed(row) {\n      // console.log(args)\n      return (row.completedLength / row.totalLength * 100).toFixed(2) + '%'\n    },\n    // goDetail(task) {\n    //   this.$router.push('/task/' + task.gid)\n    // },\n    async updateList() {\n      try {\n        this.tasks = [\n          ...await this.aria2.tellActive(),\n          ...await this.aria2.tellWaiting(0, 100)\n        ]\n      } catch(e) {\n        this.tasks = []\n        throw e\n      }\n    },\n    // 对选中的任务执行某种操作：开始，暂停，删除\n    async execSelected(action) {\n      if (action == 'remove') {\n        try {\n          await this.$confirm('确定删除吗?')\n        } catch(e) {\n          return\n        }\n      }\n\n      var selectedTask = this.tasks.filter(task => {\n        return this.selected.includes(task.gid)\n      })\n      for (let task of selectedTask) {\n        try {\n          if (action == 'pause' && task.status == 'paused') {\n            continue\n          }\n          if (action == 'unpause' && task.status == 'active') {\n            continue\n          }\n          await this.aria2[action](task.gid)\n        } catch(e) {\n          this.$alert(e.message).then(() => {\n            console.log('okkkkk')\n          })\n        }\n      }\n      this.updateList()\n    },\n    selectAll() {\n      if (this.selected.length == this.tasks.length) {\n        this.selected = []\n      } else {\n        this.selected = this.tasks.map(it => it.gid)\n      }\n    },\n    toggleSelect(task) {\n      var idx = this.selected.indexOf(task.gid)\n\n      if (idx == -1) {\n        this.selected.push(task.gid)\n      } else {\n        this.selected.splice(idx, 1)\n      }\n    },\n    getFilename(task) {\n      if (task.files?.[0].path) {\n        return task.files[0].path.split('/').at(-1)\n      } else {\n        return task.files?.uris?.[0]?.uri.split('/').at(-1) ?? '未知'\n      }\n    },\n    getPercent(task) {\n      if (task.completedLength == 0) {\n        return 0\n      } else {\n        return (task.completedLength / task.totalLength * 100) ||fixed +'%'\n      }\n    },\n  },\n  beforeDestroy() {\n    clearInterval(this.intervalId)\n  },\n  components: {\n\n  },\n};\n</script>\n"]}]}