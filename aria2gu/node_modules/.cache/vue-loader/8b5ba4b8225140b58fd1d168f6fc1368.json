{"remainingRequest":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhengwen/Desktop/zw/aria2gu/src/views/Downloading.vue?vue&type=style&index=0&id=36fefd10&lang=less&scoped=true&","dependencies":[{"path":"/Users/zhengwen/Desktop/zw/aria2gu/src/views/Downloading.vue","mtime":1639295501652},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/css-loader/dist/cjs.js","mtime":1637998138772},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1637998138938},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/postcss-loader/src/index.js","mtime":1637998138837},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/less-loader/dist/cjs.js","mtime":1637998143422},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js","mtime":1637998138883}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CnVsIHsKICBsaXN0LXN0eWxlOiBub25lOwp9CmxpIHsKICAvKiBkaXNwbGF5OiBmbGV4OyAqLwogIGN1cnNvcjogcG9pbnRlcjsKICAmLnNlbGVjdGVkIHsKICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigyMjEsIDIyMSwgMjIxKTsKICB9CiAgJjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiBza3libHVlOwogIH0KfQo="},{"version":3,"sources":["Downloading.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Downloading.vue","sourceRoot":"src/views","sourcesContent":["<style lang=\"less\" scoped>\n  ul {\n    list-style: none;\n  }\n  li {\n    /* display: flex; */\n    cursor: pointer;\n    &.selected {\n      background-color: rgb(221, 221, 221);\n    }\n    &:hover {\n      background-color: skyblue;\n    }\n  }\n</style>\n<template>\n  <div class=\"downloading\">\n    <h2>正在下载</h2>\n    <div>\n      <el-button type=\"primary\" icon=\"el-icon-video-pause\" @click=\"execSelected('pause')\">暂停</el-button>\n      <el-button type=\"primary\" icon=\"el-icon-video-play\" @click=\"execSelected('unpause')\">开始</el-button>\n      <el-button type=\"primary\" icon=\"el-icon-circle-close\" @click=\"execSelected('remove')\">删除</el-button>\n      <el-button type=\"primary\" icon=\"el-icon-check\" @click=\"selectAll\">全选</el-button>\n      <el-input size=\"small\" placeholder=\"请输入内容\" prefix-icon=\"el-icon-search\" v-model=\"searchText\"/>\n    </div>\n    <ul>\n      <li v-for=\"task of visibleTasks\" :class=\"{selected: selected.includes(task.gid)}\" :key=\"task.gid\" @click=\"toggleSelect(task)\">\n        <input type=\"checkbox\" :checked=\"selected.includes(task.gid)\" >\n        <span>{{ getFilename(task) }}</span>\n        |\n        <span>{{ getPercent(task) }}</span>\n        |\n        <span>{{ task.downloadSpeed / 1024 | fixed }}k/s</span>\n        |\n        <span>{{ task.status }}</span>\n        |\n        <!-- <button @click.stop=\"goDetail(task)\">详情</button> -->\n        <router-link @click.native.stop :to=\"{name: 'taskDetail', params: {gid: task.gid}}\">详情</router-link>\n      </li>\n    </ul>\n    <el-table\n      @sort-change=\"sortChange\"\n      :data=\"visibleTasks\"\n      style=\"width: 100%\">\n      <el-table-column\n        prop=\"gid\"\n        label=\"名称\"\n        sortable>\n      </el-table-column>\n      <el-table-column\n        :formatter=\"getPercent\"\n        label=\"进度\"\n        sortable>\n      </el-table-column>\n      <el-table-column\n        :formatter=\"getSpeed\"\n        label=\"速度\"\n        sortable>\n      </el-table-column>\n      <el-table-column\n        prop=\"status\"\n        label=\"状态\"\n        sortable>\n      </el-table-column>\n    </el-table>\n\n\n  </div>\n</template>\n\n<script>\n// @ is an alias to /src\n\nexport default {\n  name: \"Downloading\",\n  props: ['aria2'],\n  data() {\n    return {\n      tasks: [],\n      selected: [],\n      searchText: '',\n      sortColumn: '',\n    }\n  },\n  computed: {\n    visibleTasks() {\n      if (this.searchText == '') {\n        return this.tasks\n      } else {\n        return this.tasks.filter(it => {\n          return it.files[0].path.toLowerCase().includes(this.searchText.toLowerCase())\n        })\n      }\n    }\n  },\n  watch: {\n    aria2() {\n      this.tasks = []\n      this.updateList()\n    }\n  },\n  mounted() {\n    this.aria2.on('DownloadStart', () => {\n      this.updateList()\n    })\n    this.aria2.on('DownloadComplete', () => {\n      this.updateList()\n    })\n\n    this.intervalId = setInterval(async () => {\n      try {\n        await this.updateList()\n      } catch(e) {\n        if (e == 'WS_CONNECTION_ERROR') {\n          clearInterval(this.intervalId)\n        } else {\n          throw e\n        }\n      }\n    }, 100)\n  },\n  methods: {\n    sortChange({ column, prop, order }) {\n      this.sortColumn = column\n    },\n    getSpeed(row) {\n      // console.log(args)\n      return (row.downloadSpeed / 1024 ).toFixed(2) + 'k/s'\n    },\n    goDetail(task) {\n      this.$router.push('/task/' + task.gid)\n    },\n    async updateList() {\n      try {\n        this.tasks = [\n          ...await this.aria2.tellActive(),\n          ...await this.aria2.tellWaiting(0, 100)\n        ]\n      } catch(e) {\n        this.tasks = []\n        throw e\n      }\n    },\n    // 对选中的任务执行某种操作：开始，暂停，删除\n    async execSelected(action) {\n      if (action == 'remove') {\n        try {\n          await this.$confirm('确定删除吗?')\n        } catch(e) {\n          return\n        }\n      }\n\n      var selectedTask = this.tasks.filter(task => {\n        return this.selected.includes(task.gid)\n      })\n      for (let task of selectedTask) {\n        try {\n          if (action == 'pause' && task.status == 'paused') {\n            continue\n          }\n          if (action == 'unpause' && task.status == 'active') {\n            continue\n          }\n          await this.aria2[action](task.gid)\n        } catch(e) {\n          this.$alert(e.message).then(() => {\n            console.log('okkkkk')\n          })\n        }\n      }\n      this.updateList()\n    },\n    selectAll() {\n      if (this.selected.length == this.tasks.length) {\n        this.selected = []\n      } else {\n        this.selected = this.tasks.map(it => it.gid)\n      }\n    },\n    toggleSelect(task) {\n      var idx = this.selected.indexOf(task.gid)\n\n      if (idx == -1) {\n        this.selected.push(task.gid)\n      } else {\n        this.selected.splice(idx, 1)\n      }\n    },\n    getFilename(task) {\n      if (task.files?.[0].path) {\n        return task.files[0].path.split('/').at(-1)\n      } else {\n        return task.files?.uris?.[0]?.uri.split('/').at(-1) ?? '未知'\n      }\n    },\n    getPercent(task) {\n      if (task.completedLength == 0) {\n        return 0\n      } else {\n        return (task.completedLength / task.totalLength * 100).toFixed(2) +'%'\n      }\n    },\n  },\n  beforeDestroy() {\n    clearInterval(this.intervalId)\n  },\n  components: {\n\n  },\n};\n</script>\n"]}]}