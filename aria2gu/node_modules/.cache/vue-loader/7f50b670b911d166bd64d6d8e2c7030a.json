{"remainingRequest":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhengwen/Desktop/zw/aria2gu/src/views/Downloading.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhengwen/Desktop/zw/aria2gu/src/views/Downloading.vue","mtime":1638687302072},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/babel-loader/lib/index.js","mtime":1637998138838},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js","mtime":1637998138883}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIEAgaXMgYW4gYWxpYXMgdG8gL3NyYwovL2Zvcm1hdHRlcueahOWAvOWGs+Wumua4suafk+eahOWAvAoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJEb3dubG9hZGluZyIsCiAgcHJvcHM6WydhcmlhMiddLAogIGRhdGEoKXsKICAgIHJldHVybnsKICAgICAgdGFza3M6W10sCiAgICAgIHNlbGVjdGVkOltdLAogICAgICBzZWFyY2hUZXh0OicnLAogICAgfQogIH0sCiAgY29tcHV0ZWQ6ewogICAgdmlzaWJsZVRhc2tzKCl7CiAgICAgIGlmKHRoaXMuc2VhcmNoVGV4dCA9PSAnJyl7CiAgICAgICAgcmV0dXJuIHRoaXMudGFza3MKICAgICAgfWVsc2V7CiAgICAgICAgcmV0dXJuIHRoaXMudGFza3MuZmlsdGVyKGl0ID0+IHsKICAgICAgICAgIGl0LmZpbGVzWzBdLnBhdGgudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0aGlzLnNlYXJjaFRleHQudG9Mb3dlckNhc2UoKSkKICAgICAgICB9KQogICAgICB9CiAgICB9CiAgfSwKICB3YXRjaDp7CiAgICBhcmlhMigpewogICAgICB0aGlzLnRhc2tzPVtdCiAgICB9CiAgfSwKICB1cGRhdGVkKCl7CiAgICB0aGlzLnVwZGF0ZUxpc3QoKQogIH0sCiAgbW91bnRlZCgpewogICAgdGhpcy51cGRhdGVMaXN0KCkKICAgIHRoaXMuaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKGFzeW5jKCk9PnsKICAgICAgdHJ5ewogICAgICAgYXdhaXQgdGhpcy51cGRhdGVMaXN0KCkKICAgICAgfWNhdGNoKGUpewogICAgICAgIGlmKGUgPT0gJ1dTX0NPTk5FQ1RfRVJST1InKXsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbElkKQogICAgICAgIH1lbHNlewogICAgICAgICAgdGhyb3cgZQogICAgICAgIH0KICAgICAgfQogICAgfSwxMDAwKQogIH0sCiAgbWV0aG9kczp7CiAgICBnZXRTcGVlZChyb3cpewogICAgICByZXR1cm4gKHJvdy5jb21wbGV0ZWRMZW5ndGggLyByb3cudG90YWxMZW5ndGggKiAxMDApLnRvRml4ZWQoMikgKyAnJScKICAgIH0sCiAgICAvLyBnb0RldGFpbCh0YXNrKXsKICAgIC8vICAgdGhpcy4kcm91dGVyLnB1c2goJy90YXNrLycrdGFzay5naWQpCiAgICAvLyB9LAogICBhc3luYyB1cGRhdGVMaXN0KCl7CiAgICAgdHJ5ewogICAgICAgdGhpcy50YXNrcyA9IFsKICAgICAgICAuLi5hd2FpdCB0aGlzLmFyaWEyLnRlbGxBY3RpdmUoKSwKICAgICAgICAuLi5hd2FpdCB0aGlzLmFyaWEyLnRlbGxXYWl0aW5nKDAsMTAwKV0KICAgICB9Y2F0Y2goZSl7CiAgICAgICB0aGlzLnRhc2tzPVtdCiAgICAgICB0aHJvdyBlCiAgICAgfQogICAgfSwKICAgIC8vIOWvuemAieS4reeahOS7u+WKoeaJp+ihjOaTjeS9nCzmr4/mk43kvZzkuIDmrKHmm7TmlrDkuIDmrKHku7vliqHliJfooajnirbmgIEKICAgYXN5bmMgZXhlY1NlbGVjdGVkKGFjdGlvbil7CiAgICAgaWYoYWN0aW9uID09ICdyZW1vdmUnKXsKICAgICAgIHRyeXsKICAgICAgICAgYXdhaXQgdGhpcy4kY29uZmlybSgn56Gu5a6a5Yig6Zmk5ZCX77yfJykKICAgICAgIH1jYXRjaChlKXsKICAgICAgICAgIHJldHVybgogICAgICAgfQogICAgIH0KICAgICB2YXIgc2VsZWN0ZWRUYXNrID0gdGhpcy50YXNrcy5maWx0ZXIodGFzaz0+ewogICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZC5pbmNsdWRlcyh0YXNrLmdpZCkKICAgICB9KQogICAgICBmb3IobGV0IGdpZCBvZiBzZWxlY3RlZFRhc2spewogICAgICAgIHRyeXsKICAgICAgICAgIGlmKHRhc2suc3RhdHVzPT0ncGF1c2VkJyYmIGFjdGlvbj09J3BhdXNlJykKICAgICAgICAgIHsKICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIH0KICAgICAgICAgIGlmKHRhc2suc3RhdHVzID09ICdhY3RpdmUnICYmIGFjdGlvbiA9PSd1bnBhdXNlJykKICAgICAgICAgIHsKICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIH0KICAgICAgICAgIGF3YWl0IHRoaXMuYXJpYTJbYWN0aW9uXShnaWQpCiAgICAgICAgfWNhdGNoKGUpewogICAgICAgICAgdGhpcy4kYWxlcnQoZS5tZXNzYWdlKQogICAgICAgICAgY29uc29sZS5sb2coZSkKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy51cGRhdGVMaXN0KCkKICAgIH0sCiAgICBzZWxlY3RBbGwoKXsKICAgICAgaWYodGhpcy5zZWxlY3RlZC5sZW5ndGggPT0gdGhpcy50YXNrcy5sZW5ndGgpewogICAgICAgIHRoaXMuc2VsZWN0ZWQ9W10KICAgICAgfWVsc2V7CiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHRoaXMudGFza3MubWFwKGl0ID0+aXQuZ2lkKQogICAgICB9CiAgICB9LAogICAgdG9nZ2xlU2VsZWN0ZWQodGFzayl7CiAgICAgIHZhciBpZHggPSB0aGlzLnNlbGVjdGVkLmluZGV4T2YodGFzay5naWQpCiAgICAgIGlmKGlkeCA9PS0xKXsKICAgICAgICB0aGlzLnNlbGVjdGVkLnB1c2godGFzay5naWQsdHJ1ZSkKICAgICAgfWVsc2V7CiAgICAgICAgdGhpcy5zZWxlY3RlZC5zcGxpY2UoaWR4LDEpCiAgICAgIH0KICAgIH0sCiAgICBnZXRGaWxlbmFtZSh0YXNrKXsKICAgICAgaWYodGFzay5maWxlcz8uWzBdLnBhdGgpewogICAgICAgIHJldHVybiB0YXNrLmZpbGVzWzBdLnBhdGguc3BsaXQoJy8nKS5hdCgtMSkKICAgICAgfWVsc2V7CiAgICAgICAgcmV0dXJuIHRhc2suZmlsZXM/LnVyaXM/LlswXT8udXJpLnNwbGl0KCcvJykuYXQoLTEpID8/ICfmnKrnn6UnCiAgICAgIH0KICAgIH0sCiAgICAgZ2V0UGVyY2VudCh0YXNrKSB7CiAgICAgIGlmICh0YXNrLmNvbXBsZXRlZExlbmd0aCA9PSAwKSB7CiAgICAgICAgcmV0dXJuIDAKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGFzay5jb21wbGV0ZWRMZW5ndGggLyB0YXNrLnRvdGFsTGVuZ3RoICogMTAwCiAgICAgIH0KICAgIH0sCiAgICAgfSwKICBiZWZvcmVEZXN0cm95KCl7CiAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCkKICB9LAogIGNvbXBvbmVudHM6IHsKICB9LAp9Owo="},{"version":3,"sources":["Downloading.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6EA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Downloading.vue","sourceRoot":"src/views","sourcesContent":["<style lang=\"less\" scoped>\nul{\n  list-style: none;\n}\nli{\n  /* display: flex; */\n    cursor: pointer;\n  &.selected{\n    background-color: #ddd;\n  }\n  &:hover{\n    background-color: #eee;\n  }\n}\n</style>\n\n<template>\n  <div class=\"downloading\">\n  <h2>正在下载</h2>\n  <div>\n    <button @click=\"execSelected('pause')\">暂停</button>\n    <button @click=\"execSelected('unpause')\">开始</button>\n    <button @click=\"execSelected('remove')\">删除</button>\n    <button @click=\"selectAll\">全选</button>\n    搜索：<input type=\"text\" v-model=\"searchText\">\n    </div>\n  <ul>\n    <li v-for=\"task of visibleTasks\" :key = \"task.gid\" :class=\"{selected:selected.includes(task.gid)}\" @click=\"toggleSelected(task)\">\n      <input type=\"checkbox\" :checked=\"selected.includes(task.gid)\">\n      <span>{{ getFilename(task) }}</span>\n      |\n      <span>{{ getPercent(task) |fixed }}%</span>\n      |\n      <span>{{ task.downloadSpeed /1024 |fixed }}k/s</span>\n      |\n      <span>{{ task.status }}</span>\n      |\n      <!-- <button @click.stop=\"goDetail\">详情</button> -->\n      <router-link @click.native.stop :to=\"{name:'taskDetail',params:{gid:task.gid}}\">详情</router-link>\n      <!-- stop 使click事件不会冒泡到父元素上 -->\n    </li>\n  </ul>\n\n\n  <el-table\n    :data=\"visibleTasks\"\n    style=\"width: 100%\"\n    :default-sort = \"{prop: 'date', order: 'descending'}\"\n    >\n    <el-table-column\n      prop=\"gid\"\n      label=\"名称\"\n      sortable\n      width=\"180\">\n    </el-table-column>\n    <el-table-column\n      prop=\"completedLength\"\n      label=\"进度\"\n      sortable\n      width=\"180\">\n    </el-table-column>\n     <el-table-column\n      :formater=\"getSpeed\"      \n       label=\"速度\"\n      sortable\n      width=\"180\">\n    </el-table-column>\n       <el-table-column\n      prop=\"status\"\n      label=\"状态\"\n      sortable\n      width=\"180\">\n    </el-table-column>\n  </el-table>\n  </div>\n</template>\n<script>\n// @ is an alias to /src\n//formatter的值决定渲染的值\n\nexport default {\n  name: \"Downloading\",\n  props:['aria2'],\n  data(){\n    return{\n      tasks:[],\n      selected:[],\n      searchText:'',\n    }\n  },\n  computed:{\n    visibleTasks(){\n      if(this.searchText == ''){\n        return this.tasks\n      }else{\n        return this.tasks.filter(it => {\n          it.files[0].path.toLowerCase().includes(this.searchText.toLowerCase())\n        })\n      }\n    }\n  },\n  watch:{\n    aria2(){\n      this.tasks=[]\n    }\n  },\n  updated(){\n    this.updateList()\n  },\n  mounted(){\n    this.updateList()\n    this.intervalId = setInterval(async()=>{\n      try{\n       await this.updateList()\n      }catch(e){\n        if(e == 'WS_CONNECT_ERROR'){\n          clearInterval(this.intervalId)\n        }else{\n          throw e\n        }\n      }\n    },1000)\n  },\n  methods:{\n    getSpeed(row){\n      return (row.completedLength / row.totalLength * 100).toFixed(2) + '%'\n    },\n    // goDetail(task){\n    //   this.$router.push('/task/'+task.gid)\n    // },\n   async updateList(){\n     try{\n       this.tasks = [\n        ...await this.aria2.tellActive(),\n        ...await this.aria2.tellWaiting(0,100)]\n     }catch(e){\n       this.tasks=[]\n       throw e\n     }\n    },\n    // 对选中的任务执行操作,每操作一次更新一次任务列表状态\n   async execSelected(action){\n     if(action == 'remove'){\n       try{\n         await this.$confirm('确定删除吗？')\n       }catch(e){\n          return\n       }\n     }\n     var selectedTask = this.tasks.filter(task=>{\n      return this.selected.includes(task.gid)\n     })\n      for(let gid of selectedTask){\n        try{\n          if(task.status=='paused'&& action=='pause')\n          {\n            continue\n          }\n          if(task.status == 'active' && action =='unpause')\n          {\n            continue\n          }\n          await this.aria2[action](gid)\n        }catch(e){\n          this.$alert(e.message)\n          console.log(e)\n        }\n      }\n      this.updateList()\n    },\n    selectAll(){\n      if(this.selected.length == this.tasks.length){\n        this.selected=[]\n      }else{\n        this.selected = this.tasks.map(it =>it.gid)\n      }\n    },\n    toggleSelected(task){\n      var idx = this.selected.indexOf(task.gid)\n      if(idx ==-1){\n        this.selected.push(task.gid,true)\n      }else{\n        this.selected.splice(idx,1)\n      }\n    },\n    getFilename(task){\n      if(task.files?.[0].path){\n        return task.files[0].path.split('/').at(-1)\n      }else{\n        return task.files?.uris?.[0]?.uri.split('/').at(-1) ?? '未知'\n      }\n    },\n     getPercent(task) {\n      if (task.completedLength == 0) {\n        return 0\n      } else {\n        return task.completedLength / task.totalLength * 100\n      }\n    },\n     },\n  beforeDestroy(){\n    clearInterval(this.intervalId)\n  },\n  components: {\n  },\n};\n</script>\n"]}]}