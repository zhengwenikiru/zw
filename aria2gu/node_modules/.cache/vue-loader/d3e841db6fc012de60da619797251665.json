{"remainingRequest":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhengwen/Desktop/zw/aria2gu/src/views/Downloading.vue?vue&type=style&index=0&id=77f1781e&lang=less&scoped=true&","dependencies":[{"path":"/Users/zhengwen/Desktop/zw/aria2gu/src/views/Downloading.vue","mtime":1638687302072},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/css-loader/dist/cjs.js","mtime":1637998138772},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1637998138938},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/postcss-loader/src/index.js","mtime":1637998138837},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/less-loader/dist/cjs.js","mtime":1637998143422},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js","mtime":1637998138883}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CnVsewogIGxpc3Qtc3R5bGU6IG5vbmU7Cn0KbGl7CiAgLyogZGlzcGxheTogZmxleDsgKi8KICAgIGN1cnNvcjogcG9pbnRlcjsKICAmLnNlbGVjdGVkewogICAgYmFja2dyb3VuZC1jb2xvcjogI2RkZDsKICB9CiAgJjpob3ZlcnsKICAgIGJhY2tncm91bmQtY29sb3I6ICNlZWU7CiAgfQp9Cg=="},{"version":3,"sources":["Downloading.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Downloading.vue","sourceRoot":"src/views","sourcesContent":["<style lang=\"less\" scoped>\nul{\n  list-style: none;\n}\nli{\n  /* display: flex; */\n    cursor: pointer;\n  &.selected{\n    background-color: #ddd;\n  }\n  &:hover{\n    background-color: #eee;\n  }\n}\n</style>\n\n<template>\n  <div class=\"downloading\">\n  <h2>正在下载</h2>\n  <div>\n    <button @click=\"execSelected('pause')\">暂停</button>\n    <button @click=\"execSelected('unpause')\">开始</button>\n    <button @click=\"execSelected('remove')\">删除</button>\n    <button @click=\"selectAll\">全选</button>\n    搜索：<input type=\"text\" v-model=\"searchText\">\n    </div>\n  <ul>\n    <li v-for=\"task of visibleTasks\" :key = \"task.gid\" :class=\"{selected:selected.includes(task.gid)}\" @click=\"toggleSelected(task)\">\n      <input type=\"checkbox\" :checked=\"selected.includes(task.gid)\">\n      <span>{{ getFilename(task) }}</span>\n      |\n      <span>{{ getPercent(task) |fixed }}%</span>\n      |\n      <span>{{ task.downloadSpeed /1024 |fixed }}k/s</span>\n      |\n      <span>{{ task.status }}</span>\n      |\n      <!-- <button @click.stop=\"goDetail\">详情</button> -->\n      <router-link @click.native.stop :to=\"{name:'taskDetail',params:{gid:task.gid}}\">详情</router-link>\n      <!-- stop 使click事件不会冒泡到父元素上 -->\n    </li>\n  </ul>\n\n\n  <el-table\n    :data=\"visibleTasks\"\n    style=\"width: 100%\"\n    :default-sort = \"{prop: 'date', order: 'descending'}\"\n    >\n    <el-table-column\n      prop=\"gid\"\n      label=\"名称\"\n      sortable\n      width=\"180\">\n    </el-table-column>\n    <el-table-column\n      prop=\"completedLength\"\n      label=\"进度\"\n      sortable\n      width=\"180\">\n    </el-table-column>\n     <el-table-column\n      :formater=\"getSpeed\"      \n       label=\"速度\"\n      sortable\n      width=\"180\">\n    </el-table-column>\n       <el-table-column\n      prop=\"status\"\n      label=\"状态\"\n      sortable\n      width=\"180\">\n    </el-table-column>\n  </el-table>\n  </div>\n</template>\n<script>\n// @ is an alias to /src\n//formatter的值决定渲染的值\n\nexport default {\n  name: \"Downloading\",\n  props:['aria2'],\n  data(){\n    return{\n      tasks:[],\n      selected:[],\n      searchText:'',\n    }\n  },\n  computed:{\n    visibleTasks(){\n      if(this.searchText == ''){\n        return this.tasks\n      }else{\n        return this.tasks.filter(it => {\n          it.files[0].path.toLowerCase().includes(this.searchText.toLowerCase())\n        })\n      }\n    }\n  },\n  watch:{\n    aria2(){\n      this.tasks=[]\n    }\n  },\n  updated(){\n    this.updateList()\n  },\n  mounted(){\n    this.updateList()\n    this.intervalId = setInterval(async()=>{\n      try{\n       await this.updateList()\n      }catch(e){\n        if(e == 'WS_CONNECT_ERROR'){\n          clearInterval(this.intervalId)\n        }else{\n          throw e\n        }\n      }\n    },1000)\n  },\n  methods:{\n    getSpeed(row){\n      return (row.completedLength / row.totalLength * 100).toFixed(2) + '%'\n    },\n    // goDetail(task){\n    //   this.$router.push('/task/'+task.gid)\n    // },\n   async updateList(){\n     try{\n       this.tasks = [\n        ...await this.aria2.tellActive(),\n        ...await this.aria2.tellWaiting(0,100)]\n     }catch(e){\n       this.tasks=[]\n       throw e\n     }\n    },\n    // 对选中的任务执行操作,每操作一次更新一次任务列表状态\n   async execSelected(action){\n     if(action == 'remove'){\n       try{\n         await this.$confirm('确定删除吗？')\n       }catch(e){\n          return\n       }\n     }\n     var selectedTask = this.tasks.filter(task=>{\n      return this.selected.includes(task.gid)\n     })\n      for(let gid of selectedTask){\n        try{\n          if(task.status=='paused'&& action=='pause')\n          {\n            continue\n          }\n          if(task.status == 'active' && action =='unpause')\n          {\n            continue\n          }\n          await this.aria2[action](gid)\n        }catch(e){\n          this.$alert(e.message)\n          console.log(e)\n        }\n      }\n      this.updateList()\n    },\n    selectAll(){\n      if(this.selected.length == this.tasks.length){\n        this.selected=[]\n      }else{\n        this.selected = this.tasks.map(it =>it.gid)\n      }\n    },\n    toggleSelected(task){\n      var idx = this.selected.indexOf(task.gid)\n      if(idx ==-1){\n        this.selected.push(task.gid,true)\n      }else{\n        this.selected.splice(idx,1)\n      }\n    },\n    getFilename(task){\n      if(task.files?.[0].path){\n        return task.files[0].path.split('/').at(-1)\n      }else{\n        return task.files?.uris?.[0]?.uri.split('/').at(-1) ?? '未知'\n      }\n    },\n     getPercent(task) {\n      if (task.completedLength == 0) {\n        return 0\n      } else {\n        return task.completedLength / task.totalLength * 100\n      }\n    },\n     },\n  beforeDestroy(){\n    clearInterval(this.intervalId)\n  },\n  components: {\n  },\n};\n</script>\n"]}]}