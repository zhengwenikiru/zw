{"remainingRequest":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhengwen/Desktop/zw/aria2gu/src/App.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"/Users/zhengwen/Desktop/zw/aria2gu/src/App.vue","mtime":1639296528206},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/css-loader/dist/cjs.js","mtime":1637998138772},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1637998138938},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/postcss-loader/src/index.js","mtime":1637998138837},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/less-loader/dist/cjs.js","mtime":1637998143422},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/cache-loader/dist/cjs.js","mtime":1637998138681},{"path":"/Users/zhengwen/Desktop/zw/aria2gu/node_modules/vue-loader/lib/index.js","mtime":1637998138883}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Cmh0bWwsIGJvZHkgewogIG1hcmdpbjogMDsKICBwYWRkaW5nOiAwOwogIGhlaWdodDogMTAwJTsKfQojYXBwIHsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDEwMCU7CiAgZGlzcGxheTogZmxleDsKICBtaW4td2lkdGg6IDU1MHB4OwogIGJvcmRlcjogMTBweCBzb2xpZCBza3libHVlOwogIGJvcmRlci1yYWRpdXM6IDMwcHg7Cn0KLm1haW4gewogIG1heC13aWR0aDogODAwcHg7CiAgZmxleC1ncm93OiAxOwogIGZvbnQtZmFtaWx5OiBBdmVuaXIsIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgLXdlYmtpdC1mb250LXNtb290aGluZzogYW50aWFsaWFzZWQ7CiAgLW1vei1vc3gtZm9udC1zbW9vdGhpbmc6IGdyYXlzY2FsZTsKICAvLyB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgY29sb3I6ICMyYzNlNTA7CiAgZGlzcGxheTogZmxleDsKICBoMiB7CiAgICBtYXJnaW46IDA7CiAgfQp9CgojbmF2IHsKICB3aWR0aDogODBweDsKICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZDsKICBwYWRkaW5nOiAxMHB4OwogIGZsZXgtZ3JvdzogMDsKICBmbGV4LXNocmluazogMDsKCiAgYSB7CiAgICBkaXNwbGF5OiBibG9jazsKICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgY29sb3I6ICMyYzNlNTA7CgogICAgJi5yb3V0ZXItbGluay1leGFjdC1hY3RpdmUgewogICAgICBjb2xvcjogc2t5Ymx1ZTsKICAgIH0KICB9Cn0KLmdsb2JhbC1zdGF0IHsKICB0ZXh0LWFsaWduOiByaWdodDsKfQo="},{"version":3,"sources":["App.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<style lang=\"less\">\nhtml, body {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n#app {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  min-width: 550px;\n  border: 10px solid skyblue;\n  border-radius: 30px;\n}\n.main {\n  max-width: 800px;\n  flex-grow: 1;\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  // text-align: center;\n  color: #2c3e50;\n  display: flex;\n  h2 {\n    margin: 0;\n  }\n}\n\n#nav {\n  width: 80px;\n  border-right: 1px solid;\n  padding: 10px;\n  flex-grow: 0;\n  flex-shrink: 0;\n\n  a {\n    display: block;\n    font-weight: bold;\n    color: #2c3e50;\n\n    &.router-link-exact-active {\n      color: skyblue;\n    }\n  }\n}\n.global-stat {\n  text-align: right;\n}\n</style>\n<template>\n  <el-container id=\"app\">\n      <el-aside width=\"120px\" id=\"nav\">\n        <select v-model=\"selectedServer\" @change=\"switchServer\">\n          <option v-for=\"(server, idx) of servers\" :value=\"server\" :key=\"idx\">{{ server.name || (server.host + ':' + server.port) }}</option>\n        </select>\n        {{ connectionStatus }}\n        <router-link to=\"/\">正在下载({{ -(-globalStat.numWaiting - globalStat.numActive) }})</router-link>\n        <router-link to=\"/completed\">已完成({{ globalStat.numStopped }})</router-link>\n        <router-link to=\"/new\">新建下载</router-link>\n        <router-link to=\"/settings\">设置</router-link>\n        <router-link to=\"/servers\">服务器列表</router-link>\n      </el-aside>\n  <el-container>\n      <el-main class=\"main\">\n      <router-view  :aria2=\"aria2\" @servers-changed=\"servers = $event\"/>\n    </el-main>\n  </el-container>\n  </el-container>\n</template>\n<script>\nimport Aria2Client from './aria2-client.js'\n\nexport default {\n  data() {\n    var servers = JSON.parse(localStorage.getItem('aria2Servers')) || []\n    return {\n      globalStat: {},\n      servers: servers,\n      selectedServer: null,\n      connectionStatus: '连接中...',\n      aria2: null,\n    }\n  },\n  methods: {\n    async switchServer() {\n      console.log('switch server')\n      console.log('关闭现有服务器...')\n      this.aria2?.close()\n\n      this.globalStat = {}\n\n      console.log('连接新的服务器...')\n      this.connectionStatus = '连接中...'\n      var aria2 = new Aria2Client(this.selectedServer)\n      this.aria2 = aria2\n      // 重新为aria2赋值\n      try {\n        await aria2.ready()\n        this.connectionStatus = '已连接'\n      } catch(e) {\n        this.connectionStatus = '连接失败'\n      }\n    },\n    startIntervalUpdate() {\n      this.intervalId = setInterval(async () => {\n        try {\n          this.globalStat = await this.aria2.getGlobalStat()\n        } catch(e) {\n          if (e == 'WS_CONNECTION_ERROR') {\n        \n            clearInterval(this.intervalId)\n          } else {\n            throw e\n          }\n        }\n      }, 3000) // 每3s刷新一次全局状态\n      console.log('app interval id', this.intervalId)\n    }\n  },\n  created() {\n    console.log('app created')\n    this.selectedServer = this.servers[0]\n    this.switchServer()\n  },\n  async mounted() {\n\n    this.aria2.on('DownloadStart', async task => {\n      console.log('有任务开始了', task.gid)\n      this.globalStat = await this.aria2.getGlobalStat()\n    })\n    this.aria2.on('DownloadComplete', async task => {\n      console.log('有任务完成了', task.gid)\n      this.globalStat = await this.aria2.getGlobalStat()\n    })\n\n\n    try {\n      this.globalStat = await this.aria2.getGlobalStat()\n      this.startIntervalUpdate()\n\n    } catch(e) {\n      if (e == 'WS_CONNECTION_ERROR') {\n      \n      } else {\n        throw e\n      }\n    }\n  },\n  watch: {\n    async aria2() {\n      clearInterval(this.intervalId)\n      this.globalStat = await this.aria2.getGlobalStat()\n      this.startIntervalUpdate()\n    }\n  },\n  beforeDestroy() {\n    clearInterval(this.intervalId)\n  }\n}\n</script>\n"]}]}